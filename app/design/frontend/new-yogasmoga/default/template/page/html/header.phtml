<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/**
 * @var Mage_Page_Block_Html_Header $this
 */
?>
<!-- Paste this code right after the <body> tag on every page of your site. -->
    <!-- Qualaroo for yogasmoga.com  -->
<?php $serverType = Mage::getModel('core/variable')->loadByCode('server_type')->getValue('plain');
if($serverType == 'production')
{
    ?>
<script type="text/javascript">
  var _kiq = _kiq || [];
  (function(){
    setTimeout(function(){
    var d = document, f = d.getElementsByTagName('script')[0], s = d.createElement('script'); s.type = 'text/javascript';
    s.async = true; s.src = '//s3.amazonaws.com/ki.js/17463/aYr.js'; f.parentNode.insertBefore(s, f);
    }, 1);
  })();

             
</script>
    <?php   }  ?>
    <!--  END Qualaroo for yogasmoga.com  -->
<?php
    //echo "ehllo = ".Mage::getSingleton('core/session')->getisfirsttime();
    //Mage::getSingleton('core/session')->setmyVariable('myValue');
    //echo Mage::getSingleton('core/session')->getmyVariable();
?>

<!-- sign-up pop up for first time user  -->
<script type="text/javascript">
    jQuery(document).ready(function($){
        if(window.location.href.indexOf('https://') >= 0)
            _usesecureurl = true;
        else
            _usesecureurl = false;
        var url = homeUrl + 'mycatalog/myproduct/checkforsignuppopup';
        if(_usesecureurl)
            url = securehomeUrl + 'mycatalog/myproduct/checkforsignuppopup';
        jQuery.ajax({
            url : url,
            type : 'POST',
           // data : {'firstname':fname,'lastname':lname,'email':email_id,'password':pwd,'confirmation':cpassword,'is_subscribed':is_subscribed},

            success : function(data){
                 data = eval('('+data + ')');
                var status = data.status;

                if(status == "success")
                {
                    $("#signup").dialog( "open" );
                    $(".header-container").on("click",".topmenulinks li a,.logo a",function() {
                    var navHref = $(this).attr("href");
                    window.location = navHref;
                    });

                }

            }
        });
    });

</script>

        <!-- call signup popup  -->
        <?php echo $this->getLayout()->createBlock('core/template')->setTemplate('page/popups/popup_signup.phtml')->toHtml(); ?>
        <?php echo $this->getLayout()->createBlock('core/template')->setTemplate('page/popups/popup_signing.phtml')->toHtml(); ?>
        <script type="application/javascript">

            jQuery(document).ready(function($){
                $("#f_password").focus(function(){
                    $(this).closest("#fake_password").hide();
                    $("#o_password").show();
                    $("#p_password").focus();
                });
                $("#p_password").blur(function(){
                    $(this).closest("#o_password").hide();
                    $("#fake_password").show();
                    if($(this).val() != "" )
                    {
                        $("#fake_password").hide();
                        $("#o_password").show();
                    }
                    if($.trim($(this).val()) == "Select a password")
                    {
                        $("#fake_password").show();
                        $("#o_password").hide();
                    }
                });

                $(window).resize(function(event) {
                    var pW1 = ($(document).width() - $(".firstdialog").width())/2;
                    var pH1 = ($(window).height() - $(".firstdialog").height())/2;
                    $(".firstdialog").css({left:pW1,top:pH1+10});
                });
                setTimeout(function() {
                    $(".ui-widget-overlay").css({height:$(document).height()});
                }, 3000);

            });

        </script>
        <script type="application/javascript">
            jQuery(document).ready(function($){
                $("#signup-button").click(function(event){
                    $("#err-msg").text("");
                    var fname = $.trim($("#pfirstname").val());
                    var lname = $.trim($("#plastname").val());
                    var email_id = $.trim($("#pemail_address").val());
                    var pwd = $.trim($("#p_password").val());
                    if(fname == "" || fname == "First Name")
                    {
                        event.preventDefault();
                        $("#err-msg").css("visibility","visible");
                        $("#err-msg").text("All fields are required.");
                        // $("#pfirstname").focus();
                        return;
                    }
                    if(lname == "" || lname == "Last Name")
                    {
                        event.preventDefault();
                        $("#err-msg").css("visibility","visible");
                        $("#err-msg").text("All fields are required.");
                        // $("#plastname").focus();
                        return;
                    }
                    if(email_id == "" || email_id == "Email Address")
                    {
                        event.preventDefault();
                        $("#err-msg").css("visibility","visible");
                        $("#err-msg").text("All fields are required.");
                        // $("#pemail_address").focus();
                        return;
                    }
                    if(email_id != "")
                    {
                        if(!validateEmail($("#pemail_address").val()))
                        {
                            event.preventDefault();
                            $("#err-msg").css("visibility","visible");
                            $("#err-msg").text("Enter valid email address.");
                            // $("#pemail_address").focus();
                            return;
                        }
                    }
                    if(pwd == "" || pwd == "Select a password")
                    {
                        event.preventDefault();
                        $("#err-msg").css("visibility","visible");
                        $("#err-msg").text("All fields are required.");
                        // $("#p_password").focus();
                        return;
                    }
                    var str = $("#p_password").val();

                    if(str.length < 6 )
                    {
                        event.preventDefault();
                        $("#err-msg").css("visibility","visible");
                        $("#err-msg").text("Password requires 6 or more characters.");
                        // $("#p_password").focus();
                        return;
                    }

                    if(window.location.href.indexOf('https://') >= 0)
                        _usesecureurl = true;
                    else
                        _usesecureurl = false;
                    var url = homeUrl + 'mycatalog/myproduct/registercustomer';
                    if(_usesecureurl)
                        url = securehomeUrl + 'mycatalog/myproduct/registercustomer';
                    // var pfirstname = $("#pfirstname").val();
                    // var plastname = $("#plastname").val();
                    // var pemail_address = $("#pemail_address").val();
                    // var password = $("#p_password").val();
                    var cpassword = pwd;
                    var is_subscribed = $("#is_subscribed").val();
                    if(_checksinghupformsubmit == false)
                    {

                        _checksinghupformsubmit = true;
                        jQuery.ajax({
                            url : url,
                            type : 'POST',
                            data : {'firstname':fname,'lastname':lname,'email':email_id,'password':pwd,'confirmation':cpassword,'is_subscribed':is_subscribed},
                            beforeSend: function() {
                                $("#signup-button").css("background-image","url(<?php echo $this->getUrl()?>skin/frontend/yogasmoga/yogasmoga-theme/images/signing_up.png)");
                            },
                            success : function(data){
                                _checksinghupformsubmit  = false;
                                // console.log(data);
                                data = eval('('+data + ')');
                                var status = data.status;
                                var errors = data.errors;
                                if(status == "success")
                                {
                                    // $( "#signup" ).dialog("close");
                                    $("#sign_up_box").hide();
                                    $("#thank_you_box").show();


                                    $('.topmenulinks').html($('.topmenulinks').html().replace('Log In','MY ACCOUNT'));
                                    $( "#signup" ).dialog({
                                        close : function( event, ui ) {
                                            <?php
                                             $currentUrl = Mage::helper('core/url')->getCurrentUrl();
                                               if(strpos($currentUrl,'checkout/cart') !== false) {
                                                  ?>window.location.reload(); <?php
                                            }
                                            if(strpos($currentUrl,'customer/account/login') !== false) {
                                               ?>window.location.reload(); <?php
                                            }
                                          ?>
                                        }
                                    });

                                }
                                else{

                                    $("#signup-button").css("background-image","url(<?php echo $this->getUrl()?>skin/frontend/yogasmoga/yogasmoga-theme/images/sign-up-btn.png)");
                                    $("#err-msg").css("visibility","visible");
                                    $("#err-msg").text(errors);

                                }
                            }
                        });
                    }
                    event.preventDefault();
                });
            });
        </script>
    <?php
    //}



    ?>

<?php //} ?>


<div class="header-container">
    <div id="globalheader" class="header
    <?php
        if ($this->getIsHomePage())
        {
            Mage::getSingleton('core/session')->setisfirsttime('No');
            $isfirsttime = Mage::getSingleton('core/session')->getisfirsttime();
            //echo $isfirsttime."  sdfsd"; 
            if(strlen($isfirsttime) > 0)
            {
                echo " top0";
            }
            else
            {
                Mage::getSingleton('core/session')->setisfirsttime('No');
            }   
        }
        else
            echo " top0";
    ?>">
        <?php //if ($this->getIsHomePage()):?>
        <?php if (true):?>
        <!-- <h1 class="logo"><strong><?php echo $this->getLogoAlt() ?></strong><a href="<?php echo $this->getUrl('') ?>" title="<?php echo $this->getLogoAlt() ?>" class="logo"><img class="logo" src="<?php echo $this->getLogoSrc() ?>" alt="<?php echo $this->getLogoAlt() ?>" /></a></h1> -->
        <?php else:?>
        <!-- <h1 class="logo"><strong><?php echo $this->getLogoAlt() ?></strong><a class="logo" href="<?php echo $this->getUrl('') ?>" title="<?php echo $this->getLogoAlt() ?>"><img src="<?php echo $this->getLogoSrc() ?>" alt="<?php echo $this->getLogoAlt() ?>" /></a></h1> -->
        <?php endif?>
        
        <div class="f-left header-left">
            <h1 class="logo">
                <a class="logo" href="<?php echo $this->getUrl('') ?>" title="<?php echo $this->getLogoAlt() ?>">
                    <img src="<?php echo $this->getLogoSrc() ?>" alt="<?php echo $this->getLogoAlt() ?>" />
                </a>
            </h1>            
            <ul class="f-left main-menu">
                <?php
                $base_url = Mage::helper('core/url')->getHomeUrl();
                $currentcategoryid = Mage::getModel('catalog/layer')->getCurrentCategory()->getId();
                $cart = Mage::getModel('checkout/cart')->getQuote()->getData();
                if(isset($cart['items_qty'])){
                    $itemcount = (int)$cart['items_qty'];
                } else {
                    $itemcount = 0;
                }
                foreach (Mage::helper('catalog/category')->getStoreCategories() as $child1) {
                    if ($child1->getIsActive()) {
                        //show Main parent categories first level
                        if($child1->getId() == $currentcategoryid)
                            echo "<li><a class='menu-heading' href='".Mage::getModel("catalog/category")->load($child1->getId())->getUrl()."'>".$child1->getName()."</a>";
                        else
                            echo "<li><a class ='menu-heading' href='".Mage::getModel("catalog/category")->load($child1->getId())->getUrl()."'>".$child1->getName()."</a>";
                        // show sub categories second level

//                        echo '<ul class="sub-menu"><li><ul><li><a href="">What\'s new!</a></li><li><a href="">Shop the colors!</a></li><li><a href="">Top sellers</a></li>
//                           </ul></li>';
                        $firstcolumn = '<ul class="sub-menu"><li><ul>';
                        $remainingcolumn = '';
                        $subcategory = Mage::getModel('catalog/category')->load($child1->getId());
                        $subcategories = $subcategory->getChildrenCategories();
                        foreach ($subcategories as $child2)
                        {
                            if($child2->getIsActive()) {


                                $subsubcategory = Mage::getModel('catalog/category')->load($child2->getId());
                                $subsubcategories = $subsubcategory->getChildrenCategories();
                                if($subsubcategory->getChildrenCount() == 0){
                                    $firstcolumn .= "<li><a href=\"".$child2->getUrl()."\"> " . $child2->getName()."</a></li>";
                                }
                                else{
                                    $remainingcolumn .= "<li><a href=\"".$child2->getUrl()."\"> " . $child2->getName()."</a><ul>";
                                    // show sub categories third level
                                    foreach ($subsubcategories as $child3)
                                    {
                                        if($child3->getIsActive()) {
                                            $remainingcolumn .= "<li><a href=\"".$child3->getUrl()."\">" . $child3->getName();
                                            $remainingcolumn .= "</a></li>";
                                        }
                                    }

                                    $remainingcolumn .= "</ul></li>";
                                }

                            }
                        }
                        $firstcolumn .= "</ul>";
                        echo $firstcolumn.$remainingcolumn;
                        echo "</ul></li>";
                    }

                }
    /*            foreach (Mage::helper('catalog/category')->getStoreCategories() as $child1) {
                    if ($child1->getIsActive()) {
                        //show Main parent categories first level
                        if($child1->getId() == $currentcategoryid)
                            echo "<li><a class='menu-heading' href='".Mage::getModel("catalog/category")->load($child1->getId())->getUrl()."'>".$child1->getName()."</a>";
                        else
                            echo "<li><a class ='menu-heading' href='".Mage::getModel("catalog/category")->load($child1->getId())->getUrl()."'>".$child1->getName()."</a>";
                        // show sub categories second level
                        echo '<ul class="sub-menu"><li><ul><li><a href="">What\'s new!</a></li><li><a href="">Shop the colors!</a></li><li><a href="">Top sellers</a></li>
                           </ul></li>';
                                $subcategory = Mage::getModel('catalog/category')->load($child1->getId());
                                $subcategories = $subcategory->getChildrenCategories();
                                foreach ($subcategories as $child2)
                                {
                                    if($child2->getIsActive()) {
                                    echo "<li><a href=\"".$child2->getUrl()."\"> " . $child2->getName()."</a><ul>";
                                         // show sub categories third level
                                                $subsubcategory = Mage::getModel('catalog/category')->load($child2->getId());
                                                $subsubcategories = $subsubcategory->getChildrenCategories();
                                                foreach ($subsubcategories as $child3)
                                                {
                                                    if($child3->getIsActive()) {
                                                        echo "<li><a href=\"".$child3->getUrl()."\">" . $child3->getName();
                                                        echo "</a></li>";
                                                    }
                                                }

                                    echo "</ul></li>";
                                    }
                                }

                        echo "</ul></li>";
                    }

                }*/
                echo "</ul>";
                ?>




        </div>
        <div class="clearfix"></div>
        <div class="f-right header-right">
            <div class="right-top-block r-align">
                <ul class="tr-menu">
                    <li class="free-shipping">Free and fast shipping to US and Canada</li>
                    <li>
                        <a href="">Help</a>
                        <ul class="sub-menu l-align" style="left: -70px;">
                            <li class="blank"></li>
                            <li style="padding-top: 16px;"><a href="">Contact Us</a></li>
                            <li><a href="">FAQ</a></li>
                            <li><a href="">shipping and returns</a></li>
                            <li><a href="">size chart</a></li>
                            <li class="last"><a href="">product care</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="">My Account</a>
                        <ul class="sub-menu l-align" style="left: -50px;">
                            <li class="blank"></li>
                            <li style="padding-top: 16px;"><a href="">track order</a></li>
                            <li><a href="">account settings</a></li>
                            <li class="last"><a id="signin" href="javascript:void(0);">sign in</a></li>
                        </ul>
                    </li>
                    <li><a href="javascript:void(0);">Shopping Bag (<span class="cartitemcount"><?php echo $itemcount; ?></span>)</a></li>
                </ul>
            </div>
            <div class="right-bottom-block">                
                <div class="in-bl">
                    <ul class="main-menu main-menu2">                                          
                        <li>
                            <a href="<?php echo $this->getBaseUrl();?>our-story-new#story" class="main-heading">ys story</a>

                            <ul id="cms-header-link" class="sub-menu l-align" style="left:-52px;">

                                        <li data-blockid = "story"><a href="<?php echo $this->getBaseUrl();?>our-story-new#story">Our Story</a></li>
                                        <li data-blockid = "corevalues"><a href="<?php echo $this->getBaseUrl();?>our-story-new#corevalues">Our core values</a></li>
                                        <li data-blockid = "ourethics"><a href="<?php echo $this->getBaseUrl();?>our-story-new#ourethics">Our ethics</a></li>
                                        <li data-blockid = "madeinusa"><a href="<?php echo $this->getBaseUrl();?>our-story-new#madeinusa">Made in usa</a></li>
                                        <li data-blockid = "principles"><a href="<?php echo $this->getBaseUrl();?>our-story-new#principles">Principles of yoga</a></li>
                                        <li data-blockid = "namaskar"><a href="<?php echo $this->getBaseUrl();?>our-story-new#namaskar">Namaskar Foundation</a></li>
                                        <li data-blockid = "press"><a href="<?php echo $this->getBaseUrl();?>our-story-new#press">Press</a></li>

                            </ul>
                        </li>
                        <li>
                            <a href="<?php echo $this->getBaseUrl();?>our-story-new#fabrictechnology" class="main-heading">ys tech</a>
                            <ul id="cms-header-link" class="sub-menu l-align" style="left:-52px;">
                                <li><a href="">ys fabric tech</a></li>
                                <li><a href="">ys color tech</a></li>
                                <li><a href="">design elements</a></li>                                                               
                            </ul>
                        </li>                        
                        <li>
                            <a href="" class="main-heading">Smogi Bucks</a>
                            <ul class="sub-menu l-align" style="left:-37px;">                                
                                <li><a href="">what is smogi bucks</a></li>
                                <li><a href="">how can i get them</a></li>
                                <li><a href="">smogi bucks balance</a></li>                                                                 
                            </ul>
                        </li>
                    </ul>
                </div>
                <?php echo $this->getChildHtml('topSearch') ?>    
                            
            </div>             
                                            
        </div>
               
        
        <div class="quick-access">
            <?php //echo $this->getChildHtml('topSearch') ?>
            <!-- <p class="welcome-msg"><?php echo $this->getWelcome() ?> <?php echo $this->getAdditionalHtml() ?></p> -->
            <?php //echo $this->getChildHtml('topLinks') ?>
            <?php //echo $this->getChildHtml('store_language') ?>
        </div>
        <?php echo $this->getChildHtml('topContainer'); ?>
    </div>
    <!-- div id="smallmenu">
        <?php //echo $this->getSkinUrl('images/YS_logo.png') ?>
    </div -->
</div>
<div id="bodycompensator"
    <?php if ($this->getIsHomePage() && strlen($isfirsttime) == 0)
        {
            ?>
                style="display:none;"
            <?php    
        }
    ?>
></div>

<div id="myminicart">
<?php /*
<div class="totalitemcount">
    <table>
        <tr>
            <td>
                You have 10 items in your bag.
            </td>
        </tr>
    </table>
</div>
<?php for($i = 0; $i <2; $i++)
    {
        ?>
            <a href="#">
            <div class="minicartitems">
                <table>
                    <tr>
                        <td class="tdproductimage">
                            <img src="http://192.168.2.110/yogasmoga/media/catalog/product/cache/1/thumbnail/50x50/040ec09b1e35df139433887a97daa66f/a/b/abstract_0017.jpg" />
                        </td>
                        <td class="tdproductdetail">
                            <div class="productname">SLIMMIE PANTS</div>
                            <div class="productdetail"><span class="productattribute">COLOR:</span>&nbsp;BLACK</div>
                            <div class="productdetail"><span class="productattribute">SIZE:</span>&nbsp;M</div>
                            <div class="productdetail"><span class="productattribute">QTY:</span>&nbsp;3</div>
                        </td>
                        <td class="tdproductprice">
                            $120.00
                        </td>
                    </tr>
                </table>
                <img class="delete" src="<?php echo $this->getSkinUrl('images/cross_mini_cart.png'); ?>" />
            </div>
            </a>
        <?php
    }
 ?>
 <div class="bottomlinks">
    <div class="shoppingcartlink">
        <a href="#">See All</a>
     </div>
    <div class="subtotal">
        <table>
            <tr>
                <td class="anchor">
                    SUBTOTAL
                </td>
                <td class="totalprice">
                    $138.00
                </td>
            </tr>
        </table>
    </div>
    <a href="#">
        <div class="minicheckout spbutton" imageurl="<?php echo $this->getSkinUrl('images/checkout_off.png'); ?>" downimageurl="<?php echo $this->getSkinUrl('images/checkout_on.png'); ?>">
            
        </div>
    </a>
 </div>
 
 <div class="totalitemcount">
    You have no items in your cart
 </div>
 */ ?>
</div>
<?php //echo $this->getChildHtml('topMenu') ?>