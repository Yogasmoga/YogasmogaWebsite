<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product view template
 *
 * @see Mage_Catalog_Block_Product_View
 * @see Mage_Review_Block_Product_View
 */
?>
<?php
$storeId = Mage::app()->getStore()->getStoreId();

$resourceModel = Mage::getResourceModel('catalog/product');

$_helper = $this->helper('catalog/output');
$_conf_product = $this->getProduct();
$_conf_product = Mage::getModel('catalog/product')->load($_conf_product->getId());


$bundled_product_ids = $resourceModel->getAttributeRawValue($_conf_product->getId(), 'bundle_products', $storeId);

$bundledProduct = isset($bundled_product_ids) && strlen($bundled_product_ids) > 0 && strpos($bundled_product_ids, ",") != false;


if (!$bundledProduct) {

$_product = $this->getProduct();
$_product = Mage::getModel('catalog/product')->load($_product->getId());
$productName = $_product->getName();
$productId = intval($_product->getId());
/*********************** hidden page logic ********************/
$forNormal = true;
if ($this->getRequest()->getParam('hidden')) {
    $hidden = $this->getRequest()->getParam('hidden');

    if ($hidden == "true")
        $forNormal = false;
}
/*********************** hidden page logic ********************/


/************** checking if product is part of gift set *************/
    $partOfGiftSet = $_helper->productAttribute($_product, $_product->getGiftSet(), 'gift_set');

    if(isset($partOfGiftSet) && strlen(trim($partOfGiftSet))>0) {

        $allPartOfGiftSets = explode(':', $partOfGiftSet);

        $arPartOfGiftSets = array();
        foreach($allPartOfGiftSets as $partOfGiftSet) {
            $giftSetPartArr = explode(',', $partOfGiftSet);
            $giftSetTitle = $giftSetPartArr[0];
            $giftSetUrl = $giftSetPartArr[1];
            $giftSetColorCode = $giftSetPartArr[2];
            $giftSetUrl = Mage::getBaseUrl() . 'gift-sets/' . $giftSetUrl;

            $arPartOfGiftSets[$giftSetColorCode] = array("giftSetTitle" => $giftSetTitle, "giftSetUrl" => $giftSetUrl, "giftSetColorCode" => $giftSetColorCode);
        }
    }

/************** checking if product is part of gift set *************/

?>

<!--<div class="namaskar-overlay1">&nbsp;</div>-->
<script src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS);?>imagesloaded/imagesloaded.js"></script>
<script type="text/javascript">
    /*jQuery(window).load(function () {*/
	 jQuery(document).ready(function(){
        setImageContheightPDP();
        jQuery('body').css('overflow', 'auto');
       /* jQuery('.namaskar-overlay1').fadeOut('slow');*/
        jQuery("body").on("click", ".vid-popup-overlay", function () {
            var dfVid = document.getElementById("df-vid");
            var measureVid = document.getElementById("measure-vid");
            if (jQuery(".html-des-vid-popup").is(":visible")) {
                dfVid.pause();
            }
            if (jQuery(".html-fit-vid-popup").is(":visible")) {
                measureVid.pause();
            }

        });
        window.onkeyup = function (event) {
            if (event.keyCode == 27) {
                jQuery(".vid-popup-overlay").trigger("click");
            }
        }
    })
</script>
<script type="text/javascript">

 jQuery('document').ready(function(){  
 jQuery('#productdetails').before('<div class="block-loader"><img src="<?php echo $this->getSkinUrl('images/zoom_assets/preloader.gif'); ?>"/></div>');
   jQuery('#productdetails').imagesLoaded( function() {
  // images have loaded
  jQuery('#productdetails').addClass("loaded");
  jQuery('.block-loader').remove();
  //alert('product images loaded');
  });
 });
</script>
<!--<img style="display:none;" src="<?php// echo $this->getSkinUrl('images/zoom_assets/preloader.gif'); ?>"/>-->

<?php
$isRewardAble = false;

$howDoesItFitBlockId = $resourceModel->getAttributeRawValue($_product->getId(), 'how_does_it_fit', $storeId);
$sizeChartBlockId = $resourceModel->getAttributeRawValue($_product->getId(), 'size_chart', $storeId);
$fabricStoryBlockId = $resourceModel->getAttributeRawValue($_product->getId(), 'fabric_story', $storeId);
$defaultProductDescription = $resourceModel->getAttributeRawValue($_product->getId(), 'description', $storeId);// added by fahim khan.

$designFeatureVideoName = $_product->getDesignFeatureVideo();

$categoryIds = $_product->getCategoryIds();
$currentCategoryId = '';

/******************************* bread crumb logic ******************************/

$urlString = Mage::helper('core/url')->getCurrentUrl();         // the url we see in browser   ex.   http://ysrangoli.com.local/mens/bottoms/shorts
$url = Mage::getSingleton('core/url')->parseUrl($urlString);

$path = $url->getPath();    // this part of url =>    /mens/bottoms/shorts

$urlPath = explode("/", substr($path, 1));

$breadCrumbs = '<a href="' . Mage::helper('core/url')->getHomeUrl() . '">Home</a>';

if (count($urlPath) == 1)
    $breadCrumbs .= '&nbsp;/&nbsp;<a href="' . Mage::getUrl() . $urlPath[0] . '">' . $urlPath[0] . '</a>';
else if (count($urlPath) > 1) {
    $j = 0;
    $previousUrl = '';
    for ($i = 0; $i < count($urlPath) - 1; $i++) {
        if (isset($urlPath[$i - 1])) {
            $previousUrl = $previousUrl . $urlPath[$i - 1] . '/';
        }

        $breadCrumbs .= '&nbsp;/&nbsp;<a href="' . Mage::getUrl() . $previousUrl . $urlPath[$i] . '">' . $urlPath[$i] . '</a>';
    }
}
/******************************* bread crumb logic ******************************/

$colorPassed = false;
if ($this->getRequest()->getParam('color')) {
    $colorPassed = true;
    ?>

    <script type="text/javascript">
        var _defaultprcolor = '<?php echo $this->getRequest()->getParam('color'); ?>';
    </script>

    <?php
}

//if ($this->getRequest()->getParam('from') == 'dressingroom')
//    //$breadcrumb .= '&nbsp;&gt;&nbsp;<a href="'.Mage::getModel("catalog/category")->load(Mage::getModel('catalog/layer')->getCurrentCategory()->getId())->getUrl().'#dressingroom">DRESSING ROOM</a>&nbsp;&gt;';
//    $breadcrumb .= '&nbsp;/&nbsp;<a href="' . Mage::helper('core/url')->getHomeUrl() . '#dressingroom">DRESSING ROOM</a>&nbsp;&gt;';
//else
//    $breadcrumb .= '&nbsp;/&nbsp;<a href="' . Mage::getModel("catalog/category")->load(Mage::getModel('catalog/layer')->getCurrentCategory()->getId())->getUrl() . '#productgrid">ALL PRODUCTS</a>&nbsp;/';


$price = $_product->getSpecialPrice();
if ($price == "")
    $price = $_product->getPrice();
$price = round($price, 2);
if (floor($price) == $price)
    $price = floor($price);

//$productPrice = "$" . $price;
$productPrice = $price;

// get the string:   earn 5 smogi bucks with this purchase.
$rewardPointsEarned = 0.1;
$rewardPoints = Mage::helper('rewardpoints/data')->getProductPointsText($_product, false, false);
$rewardPoints = strip_tags($rewardPoints);          // remove php and html tags

// extract 5 from the string 'earn 5 smogi bucks with this purchase'
$productRewardPoints = trim(substr($rewardPoints, strpos($rewardPoints, "earn") + strlen("earn"), strpos($rewardPoints, "smogi") - 3 - strlen("smogi") - strpos($rewardPoints, "earn") + strlen("earn")));

$_childProducts = Mage::getModel('catalog/product_type_configurable')->getUsedProducts(null, $_product);
$_gallery = Mage::getModel('catalog/product')->load($_product->getId())->getMediaGalleryImages();
$configurableAttributeCollection = $_product->getTypeInstance()->getConfigurableAttributes();

$arProductColorInfo = array();
$isSizeAvailable = false;
$lengthAvailable = 0;

/****************** check Include Bra option *********************/
$optionType = null;
$optionAvailable = 0;
$arProductAllOptions = array();

foreach ($_product->getOptions() as $options) {
    $optionType = $options->getType(); // get option type

    $optionValues = $options->getValues();
    $optionAvailable = count($optionValues);

    foreach ($optionValues as $optVal)
        array_push($arProductAllOptions, $optVal->getData());
}
/****************** finish checking Include Bra option *********************/

foreach ($configurableAttributeCollection as $attribute) {
    if ($attribute->getProductAttribute()->getAttributeCode() == "size") {
        $isSizeAvailable = true;
        break;
    }
}

foreach ($configurableAttributeCollection as $attribute) {
    if ($attribute->getProductAttribute()->getAttributeCode() == "length") {
        $lengthAvailable = 1;
        break;
    }
}

$arFabricArray = array();
$arDescriptionArray = array();//CHANGE DESCRIPTION ACCORDING TO COLOR ADDED BY FK.
$arBraCupInsertArray = array();

foreach ($_childProducts as $_childProduct) {

    $colorAttributeValue = $_childProduct->getAttributeText('color');

    $childProductName = $_childProduct->getName();          // ex. U & Me Bra - Carbon 6-2
    $pos = strrpos($childProductName, '-');                 // find position of last -
    $nameWithColor = substr($childProductName, 0, $pos);    // remove last -
    $pos = strrpos($nameWithColor, '-');
    $colorName = trim(substr($nameWithColor, $pos + 1));       // get color name =>  Carbon

    $simpleProduct = Mage::getModel('catalog/product')->load($_childProduct->getId());
	

		if($forNormal) {
			$forHidden = $simpleProduct->getAttributeText('hidden_product');
			if (isset($forHidden) && (strtolower($forHidden) == "yes" || strtolower($forHidden) == "private_sale"))
				continue;
		}
		else{
			if(!in_array('100',$categoryIds)){ 

			$forHidden = $simpleProduct->getAttributeText('hidden_product');
			if (isset($forHidden) && (strtolower($forHidden) == "no" || strlen(trim($forHidden))==0))
				continue;
			}else{

			$forHidden = $simpleProduct->getAttributeText('hidden_product');
			if (isset($forHidden) && (strtolower($forHidden) == "yes" || strtolower($forHidden) != "private_sale"))
				continue;

			}
		}

	
    $sku = $_childProduct->getSku();
    $childProductBySku = Mage::getModel('catalog/product')->loadByAttribute('sku', $sku);

    /********** logic for showing 'Bra Cup Insert' only for a particular child color *******************/
    $braCupInsert = '';
    if (!isset($arBraCupInsertArray[$colorName])) {
        $braCupInsert = $childProductBySku->getAttributeText('remove_bracup_insert');

        $arBraCupInsertArray[$colorName] = $braCupInsert;
    }
    /********** logic for showing 'Bra Cup Insert' only for a particular child color *******************/

    if (strpos($colorAttributeValue, "|") !== FALSE) {
        $hexCodes = substr($colorAttributeValue, strpos($colorAttributeValue, "|") + 1);
        $hexCodes = explode(",", $hexCodes);
        $colorAttributeValue = substr($colorAttributeValue, 0, strpos($colorAttributeValue, "|"));

        if (!isset($arProductColorInfo[$colorAttributeValue]))
            $arProductColorInfo[$colorAttributeValue] = array();

        $arProductColorInfo[$colorAttributeValue]['hex'] = $hexCodes;
        $arProductColorInfo[$colorAttributeValue]['value'] = Mage::getResourceModel('catalog/product')->getAttributeRawValue($_childProduct->getId(), 'color', $storeId);

        $tempFabricStoryBlockId = Mage::getResourceModel('catalog/product')->getAttributeRawValue($_childProduct->getId(), 'fabric_story', $storeId);


        if (isset($tempFabricStoryBlockId) && strlen($tempFabricStoryBlockId) > 0) {
            $fabric_changed = true;

            $colorNameLowercase = strtolower($colorName);

            if (!isset($arFabricArray[$colorNameLowercase]))
                $arFabricArray[$colorNameLowercase] = $tempFabricStoryBlockId;
        }

        //CHANGE DESCRIPTION ACCORDING TO COLOR ADDED BY FK START.
        $tempDescriptionBlockId = Mage::getResourceModel('catalog/product')->getAttributeRawValue($_childProduct->getId(), 'description', $storeId);
        if (isset($tempDescriptionBlockId)) {
            $description_changed = true;

            $colorDescription = strtolower($colorName);

            if (!isset($arDescriptionArray[$colorDescription]))
                $arDescriptionArray[$colorDescription] = $tempDescriptionBlockId;
        }
        //CHANGE DESCRIPTION ACCORDING TO COLOR ADDED BY FK END.





    }

    /*********************** check if product is in sale or not **********************/
    if (!isset($arProductColorInfo[$colorAttributeValue]["insale"])) {
        $inSaleValue = $_childProduct->getAttributeText('insale');
        if ($inSaleValue == 'Yes')
            $arProductColorInfo[$colorAttributeValue]["insale"] = $inSaleValue;
    }
    /*********************** check if product is in sale or not **********************/

    /*********************** child price and reward points **********************/
    $price = $_childProduct->getSpecialPrice();
    if ($price == "")
        $price = $_childProduct->getPrice();
    $price = round($price, 2);
    if (floor($price) == $price)
        $price = floor($price);

    $rewardPoints = Mage::helper('rewardpoints/data')->getProductPointsText($_childProduct, false, false);
    $rewardPoints = strip_tags($rewardPoints);

    $rewardPoints = trim(substr($rewardPoints, strpos($rewardPoints, "earn") + strlen("earn"), strpos($rewardPoints, "smogi") - 3 - strlen("smogi") - strpos($rewardPoints, "earn") + strlen("earn")));
    if ($rewardPoints > 0)
        $isRewardAble = true;
    /*********************** child price and reward points **********************/

    // for Length attribute if available
    if ($lengthAvailable) {
        if (!isset($arProductColorInfo[$colorAttributeValue]["sizes"]))
            $arProductColorInfo[$colorAttributeValue]["sizes"] = array($_childProduct->getAttributeText('size'));
        else {
            if (!in_array($_childProduct->getAttributeText('size'), $arProductColorInfo[$colorAttributeValue]["sizes"]))
                array_push($arProductColorInfo[$colorAttributeValue]["sizes"], $_childProduct->getAttributeText('size'));
        }

        $temp1 = $_childProduct->getAttributeText('length') . "|" . Mage::getModel('cataloginventory/stock_item')->loadByProduct($_childProduct)->getQty() . "|" . $price . "|" . $rewardPoints;
        $temp1 .= "|" . Mage::getModel('cataloginventory/stock_item')->loadByProduct($_childProduct)->getIsInStock();
        $backOrderCheck = (int)Mage::getModel('cataloginventory/stock_item')->loadByProduct($_childProduct)->getBackorders();
        $temp1 .= "|" . $backOrderCheck;

        if (!isset($arProductColorInfo[$colorAttributeValue]["length"])) {
            $arProductColorInfo[$colorAttributeValue]["length"][$_childProduct->getAttributeText('size')] = array($temp1);
            foreach ($_gallery as $_image) {

                $imageLabelData = json_decode(trim($_image->getLabel()), true);
                if ($imageLabelData == NULL || strcasecmp($imageLabelData['type'], "product image") != 0)
                    continue;
                if ($imageLabelData['color'] == Mage::getResourceModel('catalog/product')->getAttributeRawValue($_childProduct->getId(), 'color', Mage::app()->getStore()->getStoreId())) //if(str_replace("*", "", $_image->getLabel()) == $temp)
                {
                    $alt = "";
                    if (isset($imageLabelData['alt']))
                        $alt = $imageLabelData['alt'];

                    try {
                        if ($alt == "") {
                            $abcclr = $_childProduct->getAttributeText('color');
                            if (strpos($abcclr, "|") !== false)
                                $abcclr = substr($abcclr, 0, strpos($abcclr, "|"));
                            $alt = $productName . " - " . $abcclr;
                        }
                    } catch (Exception $e) {
                        //echo $e->getMessage();
                        Mage::logException($e);
                    }
                    //echo $alt;
                    //echo $imageurl;
                    $smallImageUrl = "_" . $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile())->constrainOnly(TRUE)->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(138, 180)->setQuality(90) . "|" . $alt;
                    $imageUrl = "_" . $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile())->constrainOnly(TRUE)->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(771, 700)->setQuality(90) . "|" . $alt;
                    $zoomImageUrl = "_" . $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile())->setQuality(90) . "|" . $alt;

                    $imagePath = substr($zoomImageUrl, 1);
                    $dirImg = Mage::getBaseDir() . str_replace("/", DS, strstr($imagePath, '/media'));
                    if (file_exists($dirImg)) {
                        $imageObj = new Varien_Image($dirImg);
                        $width = $imageObj->getOriginalWidth();
                        $height = $imageObj->getOriginalHeight();
                        //echo $dirImg." - ".$width." x ".$height."<br/>";
                        $zoomImageUrl .= "|" . $width . "|" . $height;
                    }
                    //else {
                    //                        echo "File doesn't exist.";
                    //                    }

                    //if(count($productcolorinfo[$temp]["images"]) == 0)
                    if (!isset($arProductColorInfo[$colorAttributeValue]["images"])) {
                        $arProductColorInfo[$colorAttributeValue]["images"] = array();
                        $arProductColorInfo[$colorAttributeValue]["images"]["small"] = array($smallImageUrl);
                        $arProductColorInfo[$colorAttributeValue]["images"]["zoom"] = array($zoomImageUrl);
                        $arProductColorInfo[$colorAttributeValue]["images"]["big"] = array($imageUrl);
                        //echo "creating"."<br/>";
                    } else
                        if (count($arProductColorInfo[$colorAttributeValue]["images"]["small"]) < 4) {
                            array_push($arProductColorInfo[$colorAttributeValue]["images"]["big"], $imageUrl);
                            array_push($arProductColorInfo[$colorAttributeValue]["images"]["small"], $smallImageUrl);
                            //echo "pushing"."<br/>";
                            array_push($arProductColorInfo[$colorAttributeValue]["images"]["zoom"], $zoomImageUrl);
                        }
                }
            }
        } else {
            if (isset($arProductColorInfo[$colorAttributeValue]["length"][$_childProduct->getAttributeText('size')]))
                array_push($arProductColorInfo[$colorAttributeValue]["length"][$_childProduct->getAttributeText('size')], $temp1);
            else
                $arProductColorInfo[$colorAttributeValue]["length"][$_childProduct->getAttributeText('size')] = array($temp1);
        }

    } else {
        if ($isSizeAvailable)
            $temp1 = $_childProduct->getAttributeText('size') . "|" . Mage::getModel('cataloginventory/stock_item')->loadByProduct($_childProduct)->getQty() . "|" . $price . "|" . $rewardPoints;
        else
            $temp1 = "2|" . Mage::getModel('cataloginventory/stock_item')->loadByProduct($_childProduct)->getQty() . "|" . $price . "|" . $rewardPoints;
        $temp1 .= "|" . Mage::getModel('cataloginventory/stock_item')->loadByProduct($_childProduct)->getIsInStock();

        $backOrderCheck = (int)Mage::getModel('cataloginventory/stock_item')->loadByProduct($_childProduct)->getBackorders();
        $temp1 .= "|" . $backOrderCheck;
        if (isset($arProductColorInfo[$colorAttributeValue]["sizes"])) {
            array_push($arProductColorInfo[$colorAttributeValue]["sizes"], $temp1);
        } else {
            $arProductColorInfo[$colorAttributeValue]["sizes"] = array($temp1);
            if (!isset($arProductColorInfo[$colorAttributeValue]["sizes"]))
                echo "not set";

            foreach ($_gallery as $_image) {
                $imageLabelData = json_decode(trim($_image->getLabel()), true);
                if ($imageLabelData == NULL || strcasecmp($imageLabelData['type'], "product image") != 0)
                    continue;
                if ($imageLabelData['color'] == Mage::getResourceModel('catalog/product')->getAttributeRawValue($_childProduct->getId(), 'color', $storeId)) {

                    /*$alt = '';
                    if (isset($imageLabelData['alt']))
                        $alt = $imageLabelData['alt'];

                    try {
                        if ($alt == "") {
                            $abcclr = $_childProduct->getAttributeText('color');
                            if (strpos($abcclr, "|") !== false)
                                $abcclr = substr($abcclr, 0, strpos($abcclr, "|"));
                            $alt = $productName . " - " . $abcclr;
                        }
                    } catch (Exception $e) {
                        Mage::logException($e);
                    }*/
                     try {

                            $abcclr = $_childProduct->getAttributeText('color');
                            if (strpos($abcclr, "|") !== false)
                                $abcclr = substr($abcclr, 0, strpos($abcclr, "|"));
                            $alt = $productName . " - " . $abcclr;
                            $title = $productName . " - " . $abcclr;

                    } catch (Exception $e) {
                        Mage::logException($e);
                    }

                    $imageHelper = $this->helper('catalog/image');

                    $smallImageUrl = "_" . $imageHelper->init($_product, 'thumbnail', $_image->getFile())->constrainOnly(TRUE)->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(138, 180)->setQuality(90) . "|" . $alt. "|" . $title;//FK;
                    $imageUrl = "_" . $imageHelper->init($_product, 'thumbnail', $_image->getFile())->constrainOnly(TRUE)->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(771, 700)->setQuality(90) . "|" . $alt. "|" . $title;//FK;
                    $zoomImageUrl = "_" . $imageHelper->init($_product, 'thumbnail', $_image->getFile())->setQuality(90) . "|" . $alt. "|" . $title;//FK;

                    $imagePath = substr($zoomImageUrl, 1);
                    $dirImg = Mage::getBaseDir() . str_replace("/", DS, strstr($imagePath, '/media'));
                    if (file_exists($dirImg)) {
                        $imageObj = new Varien_Image($dirImg);
                        $width = $imageObj->getOriginalWidth();
                        $height = $imageObj->getOriginalHeight();

                        $zoomImageUrl .= "|" . $width . "|" . $height;
                    }

                    if (!isset($arProductColorInfo[$colorAttributeValue]["images"])) {
                        $arProductColorInfo[$colorAttributeValue]["images"] = array();
                        $arProductColorInfo[$colorAttributeValue]["images"]["small"] = array($smallImageUrl);
                        $arProductColorInfo[$colorAttributeValue]["images"]["zoom"] = array($zoomImageUrl);
                        $arProductColorInfo[$colorAttributeValue]["images"]["big"] = array($imageUrl);
                    } else {
                        if (count($arProductColorInfo[$colorAttributeValue]["images"]["small"]) < 4) {
                            array_push($arProductColorInfo[$colorAttributeValue]["images"]["big"], $imageUrl);
                            array_push($arProductColorInfo[$colorAttributeValue]["images"]["small"], $smallImageUrl);
                            array_push($arProductColorInfo[$colorAttributeValue]["images"]["zoom"], $zoomImageUrl);
                        }
                    }
                }
            }
        }
    }
}

$tempProductColorInfo = array();
$attribute = Mage::getModel('eav/config')->getAttribute('catalog_product', 'color'); //here, "color" is the attribute_code
$allOptions = $attribute->getSource()->getAllOptions(true, true);
foreach ($allOptions as $instance) {
    if (array_key_exists($instance['label'], $arProductColorInfo)) {
        $tempProductColorInfo[$instance['label']] = $arProductColorInfo[$instance['label']];

    }
}
$arProductColorInfo = $tempProductColorInfo;

$arProductAllSizes = array();

$attribute = Mage::getModel('eav/config')->getAttribute('catalog_product', 'size'); //here, "color" is the attribute_code
$allOptions = $attribute->getSource()->getAllOptions(true, true);
foreach ($allOptions as $instance) {
    if ($instance['label'] != "")
        array_push($arProductAllSizes, array("label" => $instance['label'], "value" => $instance['value']));
}

//for length attribute
$arProductAllLength = array();
if ($lengthAvailable) {
    $attribute = Mage::getModel('eav/config')->getAttribute('catalog_product', 'length'); //here, "color" is the attribute_code
    $allOptions = $attribute->getSource()->getAllOptions(true, true);
    foreach ($allOptions as $instance) {
        if ($instance['label'] != "")
            array_push($arProductAllLength, array("label" => $instance['label'], "value" => $instance['value']));
    }
}

?>

<?php if ($productId === 172 && false) { ?>
    <div
        style="padding:3px 0 !important;width: 100%; position: relative;  left: 0px; background-color: #EC0D43; z-index: 10;color: #FFFEFF;font-size: 16px;font-family: AvantGardeGothicMedium;">
        BUY 1 SLIMMIE PANT AND WE'LL SHIP YOU 2! <span style="font-family: helvetica;font-weight: bold;">&lt;&lt;</span>
        SECOND SLIMMIE: SAME SIZE, SURPRISE COLOR <span
            style="font-family: helvetica;font-weight: bold;">&gt;&gt;</span> FINAL SALE.
    </div>
<?php } ?>

<?php
if ($productId === 1808 || $productId === 1810 || $productId === 1822 || $productId === 1828 || $productId === 1836 || $productId === 1851) {
    ?>
    <div
        style="display:none; padding:3px 0 !important;width: 100%; position: relative;  left: 0px; background-color: #EC0D43; z-index: 10;color: #FFFEFF;font-size: 16px;font-family: AvantGardeGothicMedium;">
        SHOP OUR SWEATER & SCARVES SONA™ KNIT GIFT SETS FOR AN EVEN BETTER VALUE.
    </div>
<?php } ?>

<!-- ProductPage -->
<div class="product-details"  itemscope itemtype="http://schema.org/Product" itemid="#product_base">

    <!-- productdetails -->
    <div id="productdetails" desc="<?php echo html_entity_decode($productName); ?>" class="fullscreen pgsection"
         style="position: relative;" hdependson="absproductoptions"
         tw-summary="Check out the <?php echo html_entity_decode($productName); ?>">
        <script type="text/javascript">
            var optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);
        </script>
        <script type="text/javascript">
            jQuery(document).ready(function ($) {
                selectmenulink('<?php echo $categoryurl; ?>');
            });
            _islengthavailable = <?php echo $lengthAvailable;?>;
            _isoptionavailable = <?php echo $optionAvailable;?>;
            _productcolorinfo = new Array();
            _cnfrewardpoint = '<?php echo $productRewardPoints; ?>';
            <?php
            $configurableAttributeCollection=$_product->getTypeInstance()->getConfigurableAttributes();
            foreach($configurableAttributeCollection as $attribute){
                //echo "Attr-Code:".$attribute->getProductAttribute()->getAttributeCode()."<br/>";
        //        echo "Attr-Label:".$attribute->getProductAttribute()->getFrontend()->getLabel()."<br/>";
        //        echo "Attr-Id:".$attribute->getProductAttribute()->getId()."<br/>";
                ?>
            _productid = '<?php echo $productId; ?>';
            <?php
            if($attribute->getProductAttribute()->getAttributeCode() == "color")
            {
                ?>
            _colorattributeid = '<?php echo $attribute->getProductAttribute()->getId(); ?>';
            <?php
        }
        if($attribute->getProductAttribute()->getAttributeCode() == "size")
        {
            ?>
            _sizeattributeid = '<?php echo $attribute->getProductAttribute()->getId(); ?>';
            <?php
        }
        if($attribute->getProductAttribute()->getAttributeCode() == "length")
        {
            ?>
            _lengthattributeid = '<?php echo $attribute->getProductAttribute()->getId(); ?>';
            <?php
        }
        }

        $currentColorCount = 0;
        foreach($arProductColorInfo as $key=>$val)
        {
        ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>] = new Object();
            _productcolorinfo[<?php echo $currentColorCount; ?>].color = '<?php echo $key; ?>';

            // check for in sale
            <?php
                if(isset($val['insale']))
                {
            ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>].insale = '<?php echo $val['insale']; ?>';
            <?php } ?>
            // end check for in sale

            _productcolorinfo[<?php echo $currentColorCount; ?>].hex = new Array();
            <?php
                for($i = 0; $i < count($val['hex']); $i++)
                {
                    ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>].hex[<?php echo $i; ?>] = '<?php echo $val['hex'][$i]; ?>';
            <?php
        }

            if(!$lengthAvailable)
            {
            ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>].sizes = new Array();
            <?php
                for($i = 0; $i < count($val['sizes']); $i++)
                {
                    ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>].sizes[<?php echo $i; ?>] = '<?php echo $val['sizes'][$i]; ?>';
            <?php
            }

        }
        // code for size and length attribute  only in case of length attribute available
        if($lengthAvailable)
        {
        ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>].sizes = new Array();
            <?php
                for($i = 0; $i < count($val['sizes']); $i++)
                {
                    ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>].sizes[<?php echo $i; ?>] = '<?php echo $val['sizes'][$i]; ?>';
            <?php
            }
        ?>
            _productcolorinfo['<?php echo $currentColorCount; ?>'].lengths = new Array();
            <?php

                foreach($val['length'] as $key => $value)
                {
                    for($j = 0; $j < count($value); $j++)
                    {
                        if($j == 0)
                        {
                            ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>].lengths['<?php echo $key; ?>'] = new Array();
            <?php
        }
        ?>

            _productcolorinfo[<?php echo $currentColorCount; ?>].lengths['<?php echo $key; ?>'][<?php echo $j; ?>] = '<?php echo $val['length'][$key][$j]; ?>';
            <?php
            }
        }

        }
        ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>].zoomimages = new Array();
            <?php
                for($i = 0; $i < count($val['images']['zoom']); $i++)
                {
                    $abc = explode("|", $val['images']['zoom'][$i]);
                    ?>
            //console.log('<?php echo $abc[0]; ?>');
            _productcolorinfo[<?php echo $currentColorCount; ?>].zoomimages[<?php echo $i; ?>] = new Array();
            _productcolorinfo[<?php echo $currentColorCount; ?>].zoomimages[<?php echo $i; ?>][0] = "<?php echo substr($abc[0], 1); ?>";
            _productcolorinfo[<?php echo $currentColorCount; ?>].zoomimages[<?php echo $i; ?>][1] = "<?php echo $abc[1]; ?>";
            _productcolorinfo[<?php echo $currentColorCount; ?>].zoomimages[<?php echo $i; ?>][2] = "<?php echo $abc[2]; ?>";
            <?php
        }
        ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>].smallimages = new Array();
            <?php
                for($i = 0; $i < count($val['images']['small']); $i++)
                {
                    $abc = explode("|", $val['images']['small'][$i]);
                    ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>].smallimages[<?php echo $i; ?>] = new Array();
            _productcolorinfo[<?php echo $currentColorCount; ?>].smallimages[<?php echo $i; ?>][0] = "<?php echo substr($abc[0], 1); ?>";
            _productcolorinfo[<?php echo $currentColorCount; ?>].smallimages[<?php echo $i; ?>][1] = "<?php echo $abc[1]; ?>";
            _productcolorinfo[<?php echo $currentColorCount; ?>].smallimages[<?php echo $i; ?>][2] = "<?php echo $abc[2]; ?>";
            <?php
        }
        ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>].bigimages = new Array();
            <?php
                for($i = 0; $i < count($val['images']['big']); $i++)
                {
                    $abc = explode("|", $val['images']['big'][$i]);
                    ?>
            _productcolorinfo[<?php echo $currentColorCount; ?>].bigimages[<?php echo $i; ?>] = new Array();
            _productcolorinfo[<?php echo $currentColorCount; ?>].bigimages[<?php echo $i; ?>][0] = "<?php echo substr($abc[0], 1); ?>";
            _productcolorinfo[<?php echo $currentColorCount; ?>].bigimages[<?php echo $i; ?>][1] = "<?php echo $abc[1]; ?>";
            _productcolorinfo[<?php echo $currentColorCount; ?>].bigimages[<?php echo $i; ?>][2] = "<?php echo $abc[2]; ?>";
            <?php
        }
        ?>
            <?php
            $currentColorCount++;
        }
        ?>

        </script>

        <?php
        if (!$isSizeAvailable) {
            ?>
            <script type="text/javascript">
                _sizesuperattribute = false;
            </script>
            <?php
        }
        ?>
        <?php
        if ($_product->getAttributeText('canzoomimage') == "yes") {
            ?>
            <style type="text/css">
                table.productimagecontainer table.tdbigimagecontainer td img {
                    cursor: url("<?php echo $this->getSkinUrl('images/catalog/product/cursor_zoom_in.cur') ?>"), default;
                }

                td.canzoomin, td.canzoomin div, td.canzoomin img {
                    cursor: url("<?php echo $this->getSkinUrl('images/catalog/product/cursor_zoom_in.cur') ?>"), default !important;
                }

                td.canzoomout, td.canzoomout div, td.canzoomout img {
                    cursor: url("<?php echo $this->getSkinUrl('images/catalog/product/cursor_zoom_out.cur') ?>"), default !important;
                }

                img#zoomedimage1 {
                    cursor: url("<?php echo $this->getSkinUrl('images/catalog/product/cursor_zoom_in.cur') ?>"), default !important;
                    max-height: 95%;
                }

                .zoomsmallimagecontainer tr {
                    float: left;
                    width: 100px;
                }

                table.productzoomtable td.zoomproductoptions {
                    max-width: 200px;
                    min-width: 200px;
                    width: 200px;
                }

                .zoomsmallimagecontainer img {
                    margin: 0 0 25px;
                    max-width: 100%;
                }

                table.zoomsmallimagecontainer td {
                    text-align: center;
                }
				
				#productdetails .block-elm{opacity:0;}
				#productdetails.loaded .block-elm{opacity:1;}
				.block-loader {
					height: 500px;
					text-align:center;
					width: 100%;
					position:absolute;
					top:0;
					left:0;
					}
					.block-loader > img {
						position: relative;
						top: 50%;
						transform: translateY(-50%);
						-webkit-transform: translateY(-50%);
					}	
					.product-details{position:relative;}
					ul.featureList li.last-df img.vid-pl-btn{
						left: 50%!important;top: 50%!important; transform: translate(-50%, -50%);-webkit-transform: translate(-50%, -50%);						
					}
					.featureList span.ftrFig{position:relative;}
					.featureList > li:nth-child(4){padding-right:2%!important;}
            </style>
            <script type="text/javascript">
                _canzoomimages = true;
            </script>
            <?php
        }
        ?>

        <div class="block-head">
            <div class="breadcrumb"><?php echo $breadCrumbs; ?></div>
        </div>

        <!-- ProductImageAndDetailContainer -->
        <div class="block-elm">
            <!-- ProductImageContainer -->
            <div class="wdth65" style="position: relative;">
                <!-- ImageGallery -->
                <div class="upper-container">
                    <table class="productimagecontainer f-left">
                        <tr>
                            <td>
                                <div class="thumb-imgs">
                                    <table class="smallimagecontiner" width="100%">
                                        <tr></tr>
                                    </table>
                                </div>
                            </td>
                            <td>
                                <div class="show-prodImg">
                                    <table class="tdbigimagecontainer">
                                        <tr>
                                            <td></td>
                                        </tr>
                                    </table>
                                </div>
                            </td>

                        </tr>
                    </table>
                </div>
                <!-- ImageGallery -->
                <!-- featureDesign -->
                <!-- heading -->
                <div class="clear-fix"></div>
                <!--Video Block-->

                <!-- featuresList -->

                <?php
                $newdfimages = array();
                $ftimage = "";
                $ftimagespcl = "";
                $ftimagesmall = "";
                foreach ($_gallery as $_image) {
                    $imageLabelData = json_decode(trim($_image->getLabel()), true);
                    if ($imageLabelData == NULL) {
                        //echo $_image->getLabel();
                        continue;
                    }
                    if (strcasecmp($imageLabelData['type'], "new design feature image") == 0 && isset($imageLabelData['position'])) {
                        $newdfimages[$imageLabelData['position']]["url"] = "_" . $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile());
                        if (isset($imageLabelData['caption']))
                            $newdfimages[$imageLabelData['position']]["caption"] = $imageLabelData['caption'];
                        else
                            $newdfimages[$imageLabelData['position']]["caption"] = "";
                        continue;
                    }
                }
                ksort($newdfimages);
                //                echo '<pre>';print_r($newdfimages);die;
                ?>
                <?php if ($designFeatureVideoName != '' || count($newdfimages) > 1) {
                    ?>
                    <div class="h2" style="margin-bottom:30px;">Design features</div>
                    <!-- heading -->
                    <?php
                    if ($designFeatureVideoName != '') {
                        ?>
                        <!--  <div class="video-design-block">

                <video style="width:358px;" controls>
                    <source src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA) . "design_features_video/" . $_product->getDesignFeatureVideo(); ?>" type="video/mp4">

                </video>
            </div> -->
                    <?php } ?>


                    <ul class="featureList">
                        <?php
                        $i = 0;
                        foreach ($newdfimages as $ndfimg) {
                            $i++;
                            ?>
                            <li class="<?php if ($i == 4 && $designFeatureVideoName != '') {
                                echo 'last-df';
                            }
                            if ($i == 4 && $designFeatureVideoName == '') echo ' df-no-vid'; ?>"><span
                                    class="ftrFig "><img
                                        nopin="nopin" class="vid-pl-btn"
                                        src="<?php echo $this->getSkinUrl('images/vid-icon-img.png'); ?>"><img
                                        nopin="nopin"
                                        class="df-img" alt=""
                                        src="<?php echo substr($ndfimg["url"], 1); ?>"></span><span><?php echo $ndfimg["caption"]; ?></span>
                            </li>
                            <?php
                        }
                        ?>
                        <span class="clear-fix"></span>

                    </ul>
                <?php } ?>
                <!-- featuresList -->
                <?php
                $howToMeasureVidio = $_product->getHowToMeasureVideo();
                $howToMeasureVidio = Mage::getResourceModel('catalog/product')->getAttributeRawValue($_product->getId(), 'how_to_measure_video', Mage::app()->getStore()->getStoreId());
                if ($sizeChartBlockId != '' || $howToMeasureVidio != '') {
                    ?>
                    <a name="how-does-it-fit"></a>
                    <!-- heading -->
                    <div class="h2" style="margin-bottom:20px;">Fit</div>
                    <!-- heading -->

                    <div class="fitDetail font11">
                        <div class="video-box f-left">
                            <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId($howDoesItFitBlockId)->toHtml(); ?>
                            <!--<ul>
                                <li>Body hugging/form fitting</li>
                                <li>High hip length</li>
                                <li>Perfect racer back for movement</li>
                            </ul>-->

                            <div class="vlink-cont" style="margin-left:16px;">
                                <p class="block-link" style="margin-top: 15px;"><a href="#" class="com-a-prd-links">Watch
                                        how to
                                        measure</a></p>
                            </div>
                            <div class="sm-size-chart">
                                <a class="size-res"></a>
                                <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId($sizeChartBlockId)->toHtml(); ?>
                            </div>
                        </div>
                        <?php

                        if ($howToMeasureVidio != '') {
                            ?>
                            <div class="video-block f-right">
                                <img nopin="nopin"
                                     src="<?php echo $this->getSkinUrl('images/how-to-measure-thumbnail.jpg'); ?>"/>
                                </video>


                            </div>
                        <?php } ?>
                        <div class="clear-fix"></div>
                        <div class="lg-size-chart">
                            <a class="size-res-org" name="sizechart"></a>
                            <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId($sizeChartBlockId)->toHtml(); ?>
                        </div>

                    </div>
                <?php } ?>

                <!-- featureDesign -->


            </div>
            <!-- ProductImageContainer -->

            <!-- ProductDetailContainer -->
            <div class="wdth35" style="width:281px;">
                <!-- DetailsinGreyArea -->
                <div class="gry-box">
                    <div id="absproductoptions">
                        <!--<div class="disableproptions"></div>-->
                        <table class="productdetailtable normalproductdetail">
                            <tr>
                                <td>
                                    <!-- heading -->
                                    <div class="prdname">
                                        <div class="productname">
                                            <h1 itemprop="name"><?php echo html_entity_decode($productName); ?></h1></div>
                                        <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
										<span itemprop="priceCurrency" content="USD"></span>
                                        <span class="productcost amount" itemprop="price"><?php echo $productPrice; ?></span>								
										</div>
                                            <span class="was-amount no-display"
                                                  style="text-transform: lowercase;"><?php echo 'was ' . $productPrice; ?></span>

                                        <div class='part-of-gift-set' style="display: none;"></div>

                                    </div>
                                    <!-- heading -->

                                    <!-- selectColor -->
                                    <div class="box-seprtr">
                                        <div class="blck-head-sml"><span>Step 1:</span> choose your color</div>
                                        <div class="blck-head-sml">
                                            <table class="selectedcolor">
                                                <tr>
                                                    <td><span>color:</span></td>
                                                    <td class="selectedcolortext" itemprop="color"></td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div id="colorcontainer">
                                            <?php
                                            $primarycolorcode = Mage::getResourceModel('catalog/product')->getAttributeRawValue($_product->getId(), 'primarycolorcode', Mage::app()->getStore()->getStoreId());
                                            $first = true;

                                            $colorCount = 0;
                                            for ($incr = 0; $incr < 2; $incr++) {
                                                foreach ($arProductColorInfo as $key => $colorInfo) {
                                                    if ($incr == 0) {
                                                        if ($colorInfo['value'] != $primarycolorcode)
                                                            continue;
                                                    } else {
                                                        if ($colorInfo['value'] == $primarycolorcode)
                                                            continue;
                                                    }
                                                    $colorCount++;
                                                    ?>
                                                    <div>
                                                        <table color="<?php echo $key; ?>"
                                                               value="<?php echo $colorInfo['value']; ?>">
                                                            <tr>
                                                                <?php

                                                                foreach ($colorInfo['hex'] as $hex) {
                                                                    if (count($colorInfo['hex']) == 1) {

                                                                        ?>
                                                                        <td style="border-color: transparent !important; background-color: <?php echo $hex ?>;">
                                                                            <div></div>
                                                                        </td>
                                                                        <?php
                                                                    } else {
                                                                        ?>
                                                                        <td style="border-color: <?php echo $hex ?>;">
                                                                            <div></div>
                                                                        </td>
                                                                        <?php
                                                                    }
                                                                }
                                                                ?>
                                                            </tr>
                                                            <tr>
                                                                <td colspan="<?php echo count($colorInfo['hex']); ?>" <?php if ($first) {
                                                                    echo "class='tdselectedcolor'";
                                                                    $first = false;
                                                                } ?>>

                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                    <?php
                                                    //if(($colorcount % 5) == 0)
                                                    //echo "<br/>";
                                                }
                                            }

                                            ?>
                                        </div>
                                        <div style="clear:both;"></div>
                                    </div>
                                    <!-- selectColor -->

                                    <!-- selectSize -->
                                    <div class="selectedsize" <?php if (!$isSizeAvailable) {
                                        echo "style='display:none;'";
                                    } ?>>
                                        <div class="box-seprtr">
                                            <div class="blck-head-sml"><span>Step 2:</span> Select a size
                                                <table class="f-right">
                                                    <tr>
                                                        <?php if ($sizeChartBlockId != "") { ?>
                                                            <td class="sizechartlink">
                                                                <div style="position: relative;">
                                                                    <p class="block-link"
                                                                       style="margin: 0px; float: right;"><a
                                                                            id="sizechart"
                                                                            style="color:#CC0033; cursor:pointer;">Size
                                                                            chart</a></p>
                                                                    <!-- <div id="sizechart">
                                                                        <?php //echo $this->getLayout()->createBlock('cms/block')->setBlockId($sizechartblockid)->toHtml(); ?>
                                                                    </div> -->
                                                                </div>
                                                            </td>
                                                        <?php } ?>
                                                    </tr>
                                                </table>
                                            </div>
                                            <div id="sizecontainer" <?php if (!$isSizeAvailable) {
                                                echo "style='display:none;'";
                                            } ?>>
                                                <table>
                                                    <tr>
                                                        <?php
                                                        $sizecount = 0;
                                                        foreach ($arProductAllSizes as $size)
                                                        {
                                                        //if($sizecount % 6 == 0 && $sizecount > 0)
                                                        if (strpos($size['label'], "T") !== false & $sizecount == 0)
                                                        {
                                                        $sizecount++;
                                                        ?>
                                                    </tr>
                                                    <tr>
                                                        <?php
                                                        }
                                                        ?>
                                                        <td>
                                                            <div class="sizediv"
                                                                 value="<?php echo $size['value']; ?>"
                                                                 size="<?php echo $size['label']; ?>"><?php echo $size['label']; ?>
                                                                <img src="<?php echo $this->getSkinUrl('/images/out-of-stock.png'); ?>"/>
                                                            </div>
                                                        </td>
                                                        <?php
                                                        }
                                                        ?>
                                                    </tr>
                                                </table>
                                            </div>

                                            <?php if ($optionAvailable === 0) {
                                                $includeoption = "style='display:none'";
                                            } ?>

                                            <div id="includeoption" <?php echo $includeoption; ?>
                                                 class="includeoptionmain">
                                                INCLUDE BRA INSERT:
                                                <?php
                                                foreach ($arProductAllOptions as $options) {
                                                    ?>
                                                    <div value="<?php echo $options['default_price']; ?>"
                                                         title="<?php echo $options['default_title']; ?>"
                                                         optionid="<?php echo $options['option_id']; ?>"
                                                         optiontypeid="<?php echo $options['option_type_id']; ?>"><?php echo $options['default_title']; ?></div>
                                                    <?php
                                                }
                                                ?>

                                            </div>

                                        </div>
                                    </div>
                                    <!-- selectSize -->
                                    <!-- select length -->
                                    <div class="selectedlength" <?php if (!$lengthAvailable) {
                                        echo "style='display:none;'";
                                    } ?>>
                                            <span class="blck-head-sml"
                                                  style="display:block; margin-bottom: 10px;"><span>Step 3:</span> Select a length</span>
                                        <?php
                                        foreach ($arProductAllLength as $length) {
                                            ?>
                                            <div value="<?php echo $length['value']; ?>"
                                                 lengthtype="<?php echo $length['label']; ?>"><?php echo $length['label']; ?></div>
                                            <?php
                                        }
                                        ?>
                                    </div>
                                    <!-- select length -->


                                    <!-- fittable -->
                                    <div class="box-seprtr dnone">
                                        <div class="blck-head-sml"><span class="qty">Step 3:</span>
                                            Qty
                                            <?php if ($howDoesItFitBlockId != "") { ?>
                                                <table class="fittable">
                                                    <tr>
                                                        <td class="howdoesitfitlink">
                                                            <div style="position: relative;">
                                                                <p class="block-link"
                                                                   style="margin: 2px 0 0 0; float: right;"><a
                                                                        id="how-does-it-fit"
                                                                        href="javascript:void(0);">How
                                                                        does it fit?</a></p>
                                                                <!-- <div id="howdoesitfitbox">
                                                                    <div id="howdoesitfitboxinner">
                                                                        <?php //echo $this->getLayout()->createBlock('cms/block')->setBlockId($howdoesitfitblockid)->toHtml(); ?>
                                                                    </div>
                                                                    <img src="<?php //echo $this->getSkinUrl('images/catalog/product/close_opaque.png'); ?>" id="closesmlight" />
                                                                </div> -->
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </table>
                                            <?php } ?>
                                        </div>
                                        <div class="sizeselector">
                                            <select class="qtyselector">
                                                <?php
                                                for ($i = 1; $i < 21; $i++) {
                                                    ?>
                                                    <option value="<?php echo $i; ?>"><?php echo $i; ?></option>
                                                    <?php
                                                }
                                                ?>
                                            </select>
                                        </div>
                                    </div>
                                    <!-- fittable -->

                                    <!-- addToBag -->
                                    <div class="box-seprtr last" style="padding-top:10px;">
                                        <div class="blck-head-sml"><span class="qty">Step 3</span></div>

                                        <!-- addToBagBtn -->
                                        <div id="orderitem" class="addtobag spbutton"
                                             imageurl="<?php echo $this->getSkinUrl('images/catalog/product/add-to-bag-on.png'); ?>"
                                             downimageurl="<?php echo $this->getSkinUrl('images/catalog/product/add-to-bag-on.png'); ?>">
                                        </div>
                                        <div id='addtobagloader' style="display: none"><img
                                                src='/skin/frontend/new-yogasmoga/yogasmoga-theme/images/new-loader.gif'/>
                                        </div>
                                        <!-- addToBagBtn -->

                                        <!-- outOfStockBtn -->
                                        <div id="outofstockitem" class="outofstockitem"></div>
                                        <!-- outOfStockBtn -->

                                        <!-- preOrderItemBtn -->
                                        <div id="preorderitem" class="preorderitem spbutton"
                                             imageurl="<?php echo $this->getSkinUrl('images/catalog/product/pre-order-now-on.png'); ?>"
                                             downimageurl="<?php echo $this->getSkinUrl('images/catalog/product/pre-order-now-on.png'); ?>">
                                        </div>
                                        <!-- preOrderItemBtn -->

                                        <!-- producterrorcontainer -->
                                        <div class="producterrorcontainer">
                                            <div class="errormsg"></div>
                                            <!-- <div id="preorderinfo">
                                                <?php //echo Mage::getModel('core/variable')->loadByCode('preorder_message_detail')->getValue('html');
                                            ?>
                                                <img class="closeinfo" src="<?php //echo $this->getSkinUrl('images/cross_red.png');
                                            ?>" />
                                            </div>
                                            <img id="preorderhelp" src="<?php //echo $this->getSkinUrl('images/help.png');
                                            ?>" /> -->
                                        </div>
                                        <!-- producterrorcontainer -->

                                        <p class="c-align freeshipptext"><em>Free and fast shipping to US and
                                                Canada</em></p>

                                        <p class="insale dnone" style="color: #c03; margin-left: 4px;">This Item is
                                            Final Sale. Cannot be exchanged or
                                            returned.</p>
                                    </div>
                                    <!-- addToBag -->
                                </td>
                            </tr>
                        </table>
                        <img src="<?php echo $this->getSkinUrl('images/catalog/product/fabric_bg.png'); ?>"
                             class="nodisplay"/>
                    </div>
                </div>
                <!-- DetailsinGreyArea -->

                <!-- SMOGIBUCKS -->
                <table class="box-desc-dvdr font11 smogibucks">
                    <tr>
                        <td width="50%" <?php if (!$isRewardAble) {
                            echo "style='visibility:hidden'";
                        } ?>>
                            <div class="earnbucks">
                                <div class="smogibuckcount">
                                    <table>
                                        <tr>
                                            <td><?php echo $productRewardPoints; ?></td>
                                        </tr>
                                    </table>
                                </div>
                                <p class="earnsmogibuckstext">EARN <a
                                        href="<?php echo Mage::helper('core/url')->getHomeUrl(); ?>smogi-bucks"
                                        target="_blank">SMOGI
                                        BUCKS</a> WITH THIS PURCHASE</p>
                            </div>
                        </td>
                        <td width="50%" class="prd-add-to-wish">
                            <div class="wishlist">
                                <div class="social-ico">
                                    <a id="twitter" href="javascript:void(0);" class="twtrIcon"
                                       title="YogaSmoga - Twitter"></a>
                                    <!--<a  href="//www.pinterest.com/pin/create/button/" data-pin-do="buttonBookmark" ><img src="//assets.pinterest.com/images/pidgets/pinit_fg_en_rect_gray_20.png" /></a>
                                    <!-- Please call pinit.js only once per page -->
                                    <!--<script type="text/javascript" async src="//assets.pinterest.com/js/pinit.js"></script>-->
                                    <a id="pinterest" href="javascript:void(0);" class="pinIcon"
                                       title="YogaSmoga - Pinterest"></a>
                                    <a id="facebook" href="javascript:void(0);" class="fbIcon"
                                       title="YogaSmoga - Facebook"></a>
                                </div>
                                <?php
                                $_in_wishlist = false;
                                foreach (Mage::helper('wishlist')->getWishlistItemCollection() as $_wishlist_item) {
                                    if ($productId == $_wishlist_item->getProduct()->getId()) {
                                        $_in_wishlist = true;
                                        break;
                                    }
                                }

                                if (($customerId = Mage::getSingleton('customer/session')->getCustomerId()) && ($_in_wishlist)) {
                                    ?>
                                    <p class="" style="position: absolute; bottom: 0; margin-bottom: 4px; right:0;">
                                        <a
                                            onlick="javascript:void(0)">ADDED TO WISH LIST</a></p>
                                    <?php
                                } else {
                                    ?>

                                    <p class="wishlist-link"><a class="" id="<?php echo $productId; ?>"
                                                                href="<?php echo Mage::helper('core/url')->getHomeUrl(); ?>wishlist/index/add/product/<?php echo $productId; ?>/">ADD
                                            TO WISH LIST +</a></p>
                                <?php } ?>
                            </div>
                        </td>
                    </tr>
                </table>
                <!-- SMOGIBUCKS -->
                <!-- Desicription -->
                <div class="box-desc-dvdr">
                    <p style="margin-bottom: 45px;"><span
                            style="font-family:gothambold; font-size:12px;">Need help?</span> <a
                            class="chatlink" href="javascript:void($zopim.livechat.window.show())">chat with
                            us</a><span class="online"><span></span>Online now</span>
                    </p>

                    <div class="h2" style="margin-bottom:20px;">Product description</div>
                <!--Change description by Fahim Khan start code-->

                     <?php
                if ($defaultProductDescription != '') {?>
                    <div class='main-description' rel='main'>
                                <?php //echo $defaultProductDescription; ?>
                        <?php  if (strlen($defaultProductDescription) < 210) { ?>
                                <div class="shortdesc"><?php echo $defaultProductDescription; ?> </div>
                            <?php
                            }
                            else {
                            $str = $defaultProductDescription;
                            $firststr = substr($str, 0, 210);
                            $secondstr = substr($str, 210, strlen($str));
                            ?>
                            <div class="shortdesc">
                                <span><?php echo $firststr; ?></span>
                                <span class="sec-desc"><?php echo $secondstr; ?></span>
                                <span class="dot">...</span>
                                    <p class="readmore" style="margin: 0; cursor:pointer;">
                                     <span id="more">Read more</span><span id="less" class="dnone">Read less</span>
                                    </p>
                            </div>
                        <?php } ?>
                   </div>

                    <?php if ($description_changed) {

                        foreach ($arDescriptionArray as $key => $value) {?>
                            <div class='product_description_block' rel='<?php echo $key ?>'>
                                <?php  if (strlen($value) < 210) { ?>
                                    <div class="shortdesc" itemprop="description"><?php echo $value; ?> </div>
                                <?php
                                }
                                else {
                                $str = $value;
                                $firststr = substr($str, 0, 210);
                                $secondstr = substr($str, 210, strlen($str));
                                ?>
                                <div class="shortdesc">
                                    <span itemprop="description"><?php echo $firststr; ?></span><span class="sec-desc"><?php echo $secondstr; ?></span>
                                    <span class="dot">...</span>
                                        <p class="readmore" style="margin: 0; cursor:pointer;">
                                         <span id="more">Read more</span><span id="less" class="dnone">Read less</span>
                                        </p>
                                </div>
                                <?php } ?>
                            </div>
                <?php } } } ?>
                <!--Change description by Fahim Khan end code-->
            </div>
                <!--Description -->

                <!-- completeLook -->
                <!-- heading -->
                <?php //echo $this->getChildHtml('upsell_products');
                $upsell_product = $_product->getUpSellProductCollection()->addAttributeToSort('position', Varien_Db_Select::SQL_ASC)->addStoreFilter();
                $count = count($upsell_product);
                if ($count > 1) {
                    $write = Mage::getSingleton('core/resource')->getConnection('core_read');
                    $readresult = $write->query("SELECT eaov.value AS 'Attribute', eaov.option_id AS 'Value' FROM eav_attribute ea, eav_attribute_option eao, eav_attribute_option_value eaov WHERE ea.attribute_id = eao.attribute_id AND eao.option_id = eaov.option_id AND eaov.store_id = 0 AND ea.attribute_code='color'");
                    while ($row = $readresult->fetch()) {
                        $clrinfo[$row['Value']] = $row['Attribute'];
                    }
                    ?>

                    <?php
                    //check if record is empty or not
                    $upsellsimplecount = 0;
                    foreach ($upsell_product as $upsell) {
                        if ($upsellsimplecount == 2) break;
                        $product = Mage::getModel('catalog/product')->load($upsell->getId());
                        $productType = $product->getTypeID();
                        if ($productType == 'simple') {

                            $parentIds = Mage::getResourceSingleton('catalog/product_type_configurable')->getParentIdsByChild($upsell->getId());
                            if (isset($parentIds[0])) {
                                $parentproduct = Mage::getModel('catalog/product')->load($parentIds[0]);

                                $_gallery = Mage::getModel('catalog/product')->load($parentproduct->getId())->getMediaGalleryImages();
                                foreach ($_gallery as $_image) {
                                    $imageLabelData = json_decode(trim($_image->getLabel()), true);
                                    if ($imageLabelData == NULL) {
                                        //echo $_image->getLabel();
                                        continue;
                                    }


                                    if (strcasecmp($imageLabelData['type'], "product image") == 0 && $imageLabelData['color'] == $product->getColor()) {
                                        $upsellsimplecount++;
                                        // $ftimage = $this->helper('catalog/image')->init($parentproduct, 'thumbnail', $_image->getFile());
                                        $completelookimg = $this->helper('catalog/image')->init($parentproduct, 'thumbnail', $_image->getFile())->constrainOnly(TRUE)->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(121, 181)->setQuality(90);
                                        ?>

                                        <?php
                                        break;
                                    }


                                }
                                if ($upsellsimplecount == 1) {
                                    ?>
                                    <div class="newbg h2" style="margin-top:35px; margin-bottom: 27px;">complete the
                                        look</div>
                                    <ul class="similarProdList clear">
                                <?php } ?>
                                <li>
                                    <a href="<?php echo Mage::getBaseUrl() . $parentproduct->getUrlPath() . '?color=' . $product->getColor(); ?>"
                    <span><img nopin="nopin" alt="<?php echo $parentproduct->getName() ?>" title="<?php echo $parentproduct->getName() ?>"
                               src="<?php echo $completelookimg; ?>"></span>
                                <span><strong><?php echo $parentproduct->getName() ?></strong><?php echo $clrinfo[$product->getColor()] ?>
                                    <br>$<?php echo
                                    number_format((float)($parentproduct->getPrice()), 2, '.', ''); ?></span> </a>
                                </li>

                                <?php
                            }
                            ?>

                            <?php
                        }
                    }
                    if ($upsellsimplecount >= 1) {
                        ?>
                        </ul>
                    <?php } ?>
                    <?php
                }
                ?>


                <!-- completeLook -->
                <!-- prodSimilar -->
                <!-- fabricDetails  fabric story-->
                <?php
                if ($fabricStoryBlockId != '') {
                    echo "<div class='mainfabric' rel='main'>";
                    echo $this->getLayout()->createBlock('cms/block')->setBlockId($fabricStoryBlockId)->toHtml();
                    echo "</div>";

                    if ($fabric_changed) {

                        foreach ($arFabricArray as $key => $value) {
                            echo "<div class='fabric_story_block' rel='$key'>";
                            echo $this->getLayout()->createBlock('cms/block')->setBlockId($value)->toHtml();
                            echo "</div>";
                        }
                    }
                }
                ?>

                <!-- fabricDetails -->
            </div>
            <!-- ProductDetailContainer -->
        </div>
        <!-- ProductImageAndDetailContainer -->

        <!-- FitAndFabricDetails -->
        <div class="btm-divider">
        </div>
        <!-- FitAndFabricDetails -->

        <!--Container for the video Popup-->
        <?php
        if ($designFeatureVideoName != '') {
            ?>
            <div class="html-vid-pop html-des-vid-popup">
                <video id="df-vid" style="width:100%;" controls>
                    <source
                        src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA) . "design_features_video/" . $_product->getDesignFeatureVideo(); ?>"
                        type="video/mp4">
                </video>
            </div>
        <?php } ?>
        <?php
        if ($howToMeasureVidio != '') {
            ?>
            <div class="html-vid-pop html-fit-vid-popup">
                <video id="measure-vid" style="width:100%;" controls>
                    <source
                        src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA) . "how_to_measure_video/" . $_product->getHowToMeasureVideo(); ?>"
                        type="video/mp4">
                </video>
            </div>
        <?php } ?>
        <?php
        if ($designFeatureVideoName != '' || $howToMeasureVidio != '') {
            ?>
            <div class="vid-popup-overlay"></div>
        <?php } ?>
    </div>
    <!-- ProductPage -->
    <?php
    $productmodel = Mage::getResourceModel('catalog/product');
    $productId = $_product->getId();
    $currentstoreid = Mage::app()->getStore()->getStoreId();
    $dfimages = array();
    $ftimage = "";
    $ftimagespcl = "";
    $ftimagesmall = "";
    foreach ($_gallery as $_image) {
        $imageLabelData = json_decode(trim($_image->getLabel()), true);

        if ($imageLabelData == NULL)
            continue;


        if (strcasecmp($imageLabelData['type'], "fabric image big") == 0) //if($_image->getLabel() == "Fabric_Technology_Image")
        {
            $ftimage = $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile());
            $ftimagespcl = $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile())->constrainOnly(TRUE)->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(800, 800)->setQuality(90);
            ?>
            <script type="text/javascript">
                _fabrictechnologyimagespcl = '<?php echo $ftimagespcl; ?>';
            </script>
            <?php
            continue;
        }
        if (strcasecmp($imageLabelData['type'], "fabric image small") == 0) //if($_image->getLabel() == "Fabric_Technology_Image_Small")
        {
            $ftimagesmall = $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile());
            continue;
        }


        if (strcasecmp($imageLabelData['type'], "design feature image") != 0 || !isset($imageLabelData['position']))
            continue;

        $dfimages[$imageLabelData['position']]["url"] = "_" . $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile());
        if (isset($imageLabelData['caption']))
            $dfimages[$imageLabelData['position']]["caption"] = $imageLabelData['caption'];
        else
            $dfimages[$imageLabelData['position']]["caption"] = "";
    }
    //    $flag = true;
    //   for($i = 1; $i <= 5; $i++)
    //    {
    //        if(!isset($dfimages[$i]))
    //            $flag = false;
    //    }
    //echo "flag = ".$flag;
    //   if($flag)
    //{
    //      if($_product->getAttributeText('design_feature_view') == "Landscape")
    //     {
    ?>
    <!-- <div id="Designdetails" class="pgsection" desc="Design Details" tw-summary="Check out the flattering design features from YOGASMOGA">
                <!-- <table class="fullscreentable fullwidth">
                    <tr>
                        <td style="padding: 0 50px;">
                            <table class="productdesignfeatures">
                                <tr>
                                    <td style="padding:0;">
                                       <table style="width: 100%;">
                                            <tr>
                                                <td style="padding:0 3% 3% 0px;">
                                                    <div size="half">
                                                            <img class="shareit" src="<?php //echo substr($dfimages[1]["url"], 1);
    ?>" alt="<?php //echo $dfimages[1]["caption"];
    ?>" />
                                                            <div class="caption"><div><?php //echo $dfimages[1]["caption"];
    ?></div></div>
                                                        <?php /*
                                                        <div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
                                                        */
    ?>
                                                    </div>
                                                </td>
                                                <td style="width: 41.5%; padding:0 3% 3% 0px;">
                                                    <div size="half">
                                                            <img src="<?php //echo substr($dfimages[2]["url"], 1);
    ?>" alt="<?php //echo $dfimages[2]["caption"];
    ?>" />
                                                            <div class="caption"><div><?php //echo $dfimages[2]["caption"];
    ?></div></div>
                                                        <?php /*
                                                        <div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
                                                        */
    ?>
                                                    </div>
                                                </td>
                                            </tr>
                                       </table>
                                    </td>
                                    <td rowspan="2" style="width: 49.33%;padding:0;">
                                        <div size="full">
                                            <img src="<?php //echo substr($dfimages[5]["url"], 1);
    ?>" alt="<?php //echo $dfimages[3]["caption"];
    ?>" />
                                            <div class="caption"><div><?php // echo $dfimages[3]["caption"];
    ?></div></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:0;">
                                        <table style="width: 100%;">
                                            <tr>
                                                <td style="width: 41.5%; padding:0 3% 3% 0px;">
                                                    <div size="half">
                                                            <img src="<?php //echo substr($dfimages[3]["url"], 1);
    ?>" alt="<?php //echo $dfimages[4]["caption"];
    ?>" />
                                                            <div class="caption"><div><?php //echo $dfimages[4]["caption"];
    ?></div></div>
                                                        <?php /*
                                                        <div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
                                                        */
    ?>
                                                    </div>
                                                </td>
                                                <td style="padding:0 3% 3% 0px;">
                                                    <div size="half">
                                                            <img src="<?php //echo substr($dfimages[4]["url"], 1);
    ?>" alt="<?php //echo $dfimages[5]["caption"];
    ?>" />
                                                            <div class="caption"><div><?php //echo $dfimages[5]["caption"];
    ?></div></div>
                                                        <?php /*
                                                        <div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
                                                        */
    ?>
                                                    </div>
                                                </td>
                                            </tr>
                                       </table>
                                    </td>
                                </tr>
                            </table>
                            <div class="designfeaturesheadimage landscapefeature"></div>
                        </td>
                    </tr>
                </table>
            </div> -->
    <?php
    //     }
    //  if($_product->getAttributeText('design_feature_view') == "Potrait")
    //   {//
    ?>
    <!-- <div id="Designfeatures" class="pgsection" desc="Design Details" tw-summary="Check out the flattering design features from YOGASMOGA">
				<table class="fullscreentable fullwidth">
                    <tr>
                        <td style="padding: 0 40px;">
                            <table class="productdesignfeatures">
                                <tr>
                                    <td colspan="2">
                                       <div size="half">
                                                <img class="shareit" class="magnifier" src="<?php //echo substr($dfimages[1]["url"], 1);
    ?>" alt="<?php //echo $dfimages[1]["caption"];
    ?>" />
                                                <div class="caption"><div><?php //echo $dfimages[1]["caption"];
    ?></div></div>
                                            <?php /*
                                            <div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
                                            */
    ?>
                                        </div>
                                    </td>
                                    <td rowspan="2" style="width: 29.25%;">
                                        <div size="full">
                                            <img class="magnifier" src="<?php //echo substr($dfimages[2]["url"], 1);
    ?>" alt="<?php //echo $dfimages[2]["caption"];
    ?>" />
                                            <div class="caption"><div><?php //echo $dfimages[2]["caption"];
    ?></div></div>
                                        </div>
                                    </td>
                                    <td rowspan="2" style="width: 29.25%;">
                                        <div size="full">
                                            <img class="magnifier" src="<?php //echo substr($dfimages[3]["url"], 1);
    ?>" alt="<?php //echo $dfimages[3]["caption"];
    ?>" />
                                            <div class="caption"><div><?php //echo $dfimages[3]["caption"];
    ?></div></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 20.7%;">
										<div size="half">
												<img class="magnifier" src="<?php // echo substr($dfimages[4]["url"], 1);
    ?>" alt="<?php //echo $dfimages[4]["caption"];
    ?>" />
												<div class="caption"><div><?php //echo $dfimages[4]["caption"];
    ?></div></div>
											<?php /*
											<div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
											*/
    ?>
										</div>
									</td>
									<td style="width: 20.7%;">
										<div size="half">
												<img class="magnifier" src="<?php //echo substr($dfimages[5]["url"], 1);
    ?>" alt="<?php //echo $dfimages[5]["caption"];
    ?>" />
												<div class="caption"><div><?php //echo $dfimages[5]["caption"];
    ?></div></div>
											<?php /*
											<div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
											*/
    ?>
										</div>
									</td>
                                </tr>
                            </table>
                            <div class="designfeaturesheadimage potraitfeature"></div>
                        </td>
                    </tr>
                </table>
            </div> -->
    <?php
    //   }
    // }
    ?>
    <?php /*
<?php
     if($_product->getAttributeText('design_feature_view') == "Landscape"  && $productmodel->getAttributeRawValue($productid, 'design_feature_image1', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image2', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image3', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image4', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image5', $currentstoreid) != "")
     {
        ?>
            <div class="fullscreen colorbg pgsection">
                <table class="fullscreentable">
                    <tr>
                        <td style="padding: 0 50px;">
                            <table class="productdesignfeatures">
                                <tr>
                                    <td style="width: 50%;">
                                       <table style="width: 100%;">
                                            <tr>
                                                <td style="width: 60%;">
                                                    <div size="half">
                                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image1', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description1', $currentstoreid); ?>" />
                                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description1', $currentstoreid); ?></div></div>
                                                    </div>
                                                </td>
                                                <td style="width: 40%;">
                                                    <div size="half">
                                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image2', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description2', $currentstoreid); ?>" />
                                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description2', $currentstoreid); ?></div></div>
                                                    </div>
                                                </td>
                                            </tr>
                                       </table>
                                    </td>
                                    <td rowspan="2" style="width: 50%;">
                                        <div size="full">
                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image3', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description3', $currentstoreid); ?>" />
                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description3', $currentstoreid); ?></div></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 50%; vertical-align: bottom;">
                                        <table style="width: 100%;">
                                            <tr>
                                                <td style="width: 40%;">
                                                    <div size="half">
                                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image4', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description4', $currentstoreid); ?>" />
                                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description4', $currentstoreid); ?></div></div>
                                                    </div>
                                                </td>
                                                <td style="width: 60%;">
                                                    <div size="half">
                                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image5', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description5', $currentstoreid); ?>" />
                                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description5', $currentstoreid); ?></div></div>
                                                    </div>
                                                </td>
                                            </tr>
                                       </table>
                                    </td>
                                </tr>
                            </table>
                            <div class="designfeaturesheadimage landscapefeature"></div>
                        </td>
                    </tr>
                </table>
            </div>
        <?php
     }
?>
<?php
     if($_product->getAttributeText('design_feature_view') == "Potrait" && $productmodel->getAttributeRawValue($productid, 'design_feature_image1', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image2', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image3', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image4', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image5', $currentstoreid) != "")
     {
        ?>
            <div class="fullscreen colorbg pgsection">
                <table class="fullscreentable">
                    <tr>
                        <td style="padding: 0 50px;">
                            <table class="productdesignfeatures">
                                <tr>
                                    <td style="width: 33.33%;">
                                       <div size="half">
                                                <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image1', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description1', $currentstoreid); ?>" />
                                                <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description1', $currentstoreid); ?></div></div>
                                        </div>
                                    </td>
                                    <td rowspan="2" style="width: 33.33%;">
                                        <div size="full">
                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image2', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description2', $currentstoreid); ?>" />
                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description2', $currentstoreid); ?></div></div>
                                        </div>
                                    </td>
                                    <td rowspan="2" style="width: 33.33%;">
                                        <div size="full">
                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image3', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description3', $currentstoreid); ?>" />
                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description3', $currentstoreid); ?></div></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 33.33%; vertical-align: bottom;">
                                        <table style="width: 100%;">
                                            <tr>
                                                <td style="width: 50%;">
                                                    <div size="half">
                                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image4', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description4', $currentstoreid); ?>" />
                                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description4', $currentstoreid); ?></div></div>
                                                    </div>
                                                </td>
                                                <td style="width: 50%;">
                                                    <div size="half">
                                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image5', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description5', $currentstoreid); ?>" />
                                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description5', $currentstoreid); ?></div></div>
                                                    </div>
                                                </td>
                                            </tr>
                                       </table>
                                    </td>
                                </tr>
                            </table>
                            <div class="designfeaturesheadimage potraitfeature"></div>
                        </td>
                    </tr>
                </table>
            </div>
        <?php
     }
?>
*/
    ?>
    <?php /*
    $fabric_block = Mage::getResourceModel('catalog/product')->getAttributeRawValue($_product->getId(), 'fabric_technology', Mage::app()->getStore()->getStoreId());// $_product->getAttributeText('fabric_technology');
    if($fabric_block != "")
        $fabric_block_html = $this->getLayout()->createBlock('cms/block')->setBlockId($fabric_block)->toHtml();
    if($fabric_block_html != "")
    {
        ?>
            <div smorigwidth="1600" smorigheight="300" id="ftechimage" origwidth="1600" origheight="900" desc="abcd" origwidthsm="1600" origheightsm="900" class="opimage closed fxheight" style="background-image:url(<?php echo $this->getSkinUrl('images/homepage/fabric_technology-bg.jpg'); ?>); margin:0 0 80px;">
            	<?php echo $fabric_block_html; ?>
            </div>
        <?php
    }
*/
    ?>
    <?php /*
<div smorigwidth="1600" smorigheight="300" id="ftechimage" origwidth="1600" origheight="900" desc="abcd" origwidthsm="1600" origheightsm="900" class="opimage closed" style="background-image:url(<?php echo $this->getSkinUrl('images/homepage/fabric_technology-bg.jpg'); ?>); margin:0 0 80px;">
	<div class="small" style="background-image:url(<?php echo $this->getSkinUrl('images/homepage/fabric_technology-bg.jpg'); ?>);">
		<div style="top:50%; margin-top:-40px;">
			<h3 class="heading">UNVEIL</h3>
			<p style="text-transform:uppercase;">our exclusive FABRIC technology</p>
			<img src="<?php echo $this->getSkinUrl('images/homepage/febric_uv.png'); ?>" />
		</div>
	</div>
	<div class="big_small big_big">
		<div class="opbox centered">
			<h3 class="heading">discover<span>aurum+<sup>TM</sup></span></h3>
			<p>This is IT. AURUM+<sup>TM</sup>, Exclusively Ours.<br/>
			AURUM+<sup>TM</sup> is a technical blend of Supplex<sup>&reg;</sup> and Lycra<sup>&reg;</sup>. Our competitors use a form of Nylon that is inferior and falls apart quickly. Supplex<sup>&reg;</sup> fibers are technically far superior, giving you the soft feel and breathability of cotton with the performance benefits of advanced fiber technology.</p>
		</div>
		<div class="opbox usa">
			<img src="<?php echo $this->getSkinUrl('images/homepage/usa.png'); ?>" />
			<h3 class="heading">
			Fabric proudly<br/><em>made</em><br/>in the USA</h3>
			<p>Science teaches, the fabric of our society can be more than the spirituality that binds us. We know that yoga pants can be hip and trendy. But, they can also create jobs for people in need when they're manufactured in a town that's desperate for opportunity. Not only are our fabrics made by our fellow Americans, but they are also eco-friendly as they haven't accumulated frequent flyer miles. <br/>
			We are a proud American company with a deep Indian soul.</p>
		</div>

		<div class="opbox amm">
			<img src="<?php echo $this->getSkinUrl('images/homepage/amm.png'); ?>" />
			<h3 class="heading">
			advanced<br/><em>moisture</em><br/>management</h3>
			<p>Take on the world and still look calm, cool and alluring. Our exclusive nanotechnology embeds<br/> moisture-wicking & antimicrobial treatments into the tiniest pores of our fabric. And that means moisture & bacteria make a quick exit so you'll always make a serene entrance.</p>
		</div>

		<div class="opbox hqs">
			<img src="<?php echo $this->getSkinUrl('images/homepage/hqs.png'); ?>" />
			<h3 class="heading">
			High<br/><em>Quality</em><br/>Stretch</h3>
			<p>We use a superior form of Lycra<sup>&reg;</sup> with very high memory retention. Our fabrics always bounces back for that snug feeling. You can reach, bend, and move through life anyway you wish and our clothes will gracefully follow.</p>
		</div>

		<div class="opbox rtp">
			<img src="<?php echo $this->getSkinUrl('images/homepage/rtp.png'); ?>" />
			<h3 class="heading">RESISTANCE<br/>TO PILLING</h3>
			<p>Leave the Pilling to Grandma's Sweater. Your favorite things should stay your favorite things, for life. Aurum+<sup>TM</sup> contains pilling resistant Supplex<sup>&reg;</sup> technology which generic nylons just can't compare to. Wear it & wash it till your heart's content, and always look razor sharp. You will stay feeling good, and looking good longer.</p>
		</div>

		<div class="opbox nano">
			<img src="<?php echo $this->getSkinUrl('images/homepage/nano.png'); ?>" />
			<h3 class="heading">NANOTECHNOLOGY</h3>
			<p>We use advanced nanotechnology to reach deep within the micro spaces between each weave as opposed to applying it topically on the fibers. This means far advanced moisture management. Go ahead and compare, you will see the stark difference. It's our challenge.</p>
		</div>
	</div>
</div>
*/
    ?>
    <?php
    if ($ftimage != "" && $ftimagesmall != "") {
        $widthsmall = "";
        $widthbig = "";
        $heightbig = "";
        $heightsmall = "";
        $imagePath = $ftimage;
        $dirImg = Mage::getBaseDir() . str_replace("/", DS, strstr($imagePath, '/media'));
        if (file_exists($dirImg)) {
            $imageObj = new Varien_Image($dirImg);
            $width = $imageObj->getOriginalWidth();
            $height = $imageObj->getOriginalHeight();
            //echo $dirImg." - ".$width." x ".$height."<br/>";
            $ftimage .= "|" . $width . "|" . $height;
            $widthbig = $width;
            $heightbig = $height;
        }
        $imagePath = $ftimagesmall;
        $dirImg = Mage::getBaseDir() . str_replace("/", DS, strstr($imagePath, '/media'));
        if (file_exists($dirImg)) {
            $imageObj = new Varien_Image($dirImg);
            $width = $imageObj->getOriginalWidth();
            $height = $imageObj->getOriginalHeight();
            //echo $dirImg." - ".$width." x ".$height."<br/>";
            //$ftimage .= "|".$width."|".$height;
            $widthsmall = $width;
            $heightsmall = $height;
        }
        ?>
        <script type="text/javascript">
            _fabrictechnologyimage = '<?php echo $ftimage ?>';
        </script>
        <?php /*
            <div id="fabrictechnology" desc="Fabric Technology" style="background-image : url('<?php echo substr($ftimage, 0, strpos($ftimage,"|")); ?>');" class="bgimage pgsection">
                <script type="text/javascript">
                    _fabrictechnologyimage = '<?php echo $ftimage ?>';
                </script>
            </div>
            */
        ?>
        <?php
    }
    ?>
    <?php /*
<?php
     if($productmodel->getAttributeRawValue($productid, 'fabric_technology_image', $currentstoreid) != "")
     {
        ?>
            <div id="fabrictechnology" desc="Fabric Technology" style="background-image : url('<?php echo $this->getSkinUrl('images/catalog/product/fabrictechnology/'.$productmodel->getAttributeRawValue($productid, 'fabric_technology_image', $currentstoreid)); ?>');" class="bgimage pgsection">
            </div>
        <?php
     }
?>
*/
    ?>

    <?php //echo $this->getChildHtml('upsell_products')
    ?>


    <!-- onZoomProductImage -->
    <div style="display:none;">
        <div id="zoompopup">
            <table class="productzoomtable">
                <tr>
                    <td colspan="2">
                        <table class="productdetailtable zoomproductdetail" style="position:relative;">
                            <tr>
                                <td>
                                    <div class="zoom-prd-det" style="margin: 40px 20px; width: auto;">
                                        <div class="prdname in-bl vert-bottom">
                                            <div
                                                class="productname"><?php echo html_entity_decode($productName); ?></div>
                                                <span
                                                    class="productcost amount no-display"><?php echo $productPrice; ?></span>

                                        </div>
                                        <div class="box-seprtr last in-bl vert-bottom">
                                            <div class="blck-head-sml no-display"><span>Step 1:</span> choose your
                                                color
                                            </div>
                                            <div class="blck-head-sml">
                                                <table class="selectedcolor">
                                                    <tr>
                                                        <td>COLOR:</td>
                                                        <td class="selectedcolortext" itemprop="color"></td>
                                                    </tr>
                                                </table>
                                            </div>

                                            <div id="colorcontainer">
                                                <?php
                                                $first = true;
                                                $colorCount = 0;

                                                foreach ($arProductColorInfo as $key => $colorInfo) {
                                                    $colorCount++;
                                                    ?>
                                                    <div>
                                                        <table color="<?php echo $key; ?>"
                                                               value="<?php echo $colorInfo['value']; ?>">
                                                            <tr>
                                                                <?php

                                                                foreach ($colorInfo['hex'] as $hex) {
                                                                    if (count($colorInfo['hex']) == 1) {

                                                                        ?>
                                                                        <td style="border-color: transparent !important; background-color: <?php echo $hex ?>;">
                                                                            <div></div>
                                                                        </td>
                                                                        <?php
                                                                    } else {
                                                                        ?>
                                                                        <td style="border-color: <?php echo $hex ?>;">
                                                                            <div></div>
                                                                        </td>
                                                                        <?php
                                                                    }
                                                                }
                                                                ?>
                                                            </tr>
                                                            <tr>
                                                                <td colspan="<?php echo count($colorInfo['hex']); ?>" <?php if ($first) {
                                                                    echo "class='tdselectedcolor'";
                                                                    $first = false;
                                                                } ?>>

                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                    <?php
                                                    //if(($colorcount % 5) == 0)
                                                    //echo "<br/>";
                                                }
                                                ?>
                                            </div>
                                            <div style="clear:both;"></div>
                                        </div>
                                    </div>
                                    <div style="clear: both;"></div>
                                    <img id="closelightbox"
                                         src="<?php echo $this->getSkinUrl('images/catalog/product/close-prd-zoom.png'); ?>"/>

                                    <div id="zoomoptions">
                                        <img id="zoomout"
                                             src="<?php echo $this->getSkinUrl('images/catalog/product/zoom-out.png'); ?>"/>
                                        <img id="zoomin"
                                             src="<?php echo $this->getSkinUrl('images/catalog/product/zoom-in.png'); ?>"/>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td class="zoomproductoptions">
                        <table class="productdetailtable zoomproductdetail">
                            <tr>
                                <td>
                                    <div class="zoom-thumb-imgs">
                                        <table class="zoomsmallimagecontainer" style="margin-left:40px;">
                                            <tr>
                                                <td><img src="" style="margin: 0 0 25px; max-width: 100%;"/></td>
                                            </tr>
                                            <tr>
                                                <td><img src="" style="margin: 0 0 25px; max-width: 100%;"/></td>
                                            </tr>
                                            <tr>
                                                <td><img src="" style="margin: 0 0 25px; max-width: 100%;"/></td>
                                            </tr>
                                        </table>
                                    </div>
                                    <a href="javascript:void(0);" id="fbzoomtrigger" style="">Fabric Image</a>

                                    <div id="zoomedfbdtl"></div>
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td id="zoomedproductimage"></td>
                </tr>
            </table>
        </div>
    </div>

    <!-- onZoomProductImage -->
    <script type="text/javascript">
        _isOnProductDetailPage = true;
        bra_cup_insert_count = parseInt("<?php echo $optionAvailable; ?>");

        <?php
            if(isset($arPartOfGiftSets)){
                foreach($arPartOfGiftSets as $key => $data){
        ?>
                    arPartOfGiftSets[<?php echo $key;?>] = Array();
                    arPartOfGiftSets[<?php echo $key;?>][0] = "<?php echo $data['giftSetTitle'];?>";
                    arPartOfGiftSets[<?php echo $key;?>][1] = "<?php echo $data['giftSetUrl'];?>";
                    arPartOfGiftSets[<?php echo $key;?>][2] = "<?php echo $data['giftSetColorCode'];?>";
        <?php
                }
            }
        ?>
        //    window.onload = initFabric;

        <?php
            if(isset($arBraCupInsertArray) && count($arBraCupInsertArray)>0){
                foreach($arBraCupInsertArray as $key=>$value){
                    echo "bra_cup_insert_color_array.push(\"" . trim($key) . "\");";
                    echo "bra_cup_insert_value_array.push(\"" . trim($value) . "\");";
                }
            }
        ?>

        //    function initFabric() {
        //        jQuery(".selectedcolor").load(changeFabric);
        //    }
        jQuery(function ($) {
            var currentColor = $("#colorcontainer div.selected").find('table').attr('value');
            //alert(currentColor);
            wishList();

            function wishList() {
                var wishlist = ".wishlist-link";
                //$(wishlist).find("a").removeAttr("href").css("cursor", "pointer");

                jQuery(wishlist).live("click", "a", function (event) {
                    event.preventDefault();
                    if (!_islogedinuser) {
                        _isClickAddtowishlist = true;
                        jQuery("#signing_popup").dialog("open");

                    }

                    if (_islogedinuser) {

                        var productid = jQuery(wishlist).find("a").attr('id');
                        //var colorCode = jQuery(wishlist).find("a").attr('color_code');

                        if (window.location.href.indexOf('https://') >= 0)
                            _usesecureurl = true;
                        else
                            _usesecureurl = false;
                        var url = homeUrl + 'mynewtheme/addtowishlist/applyAddToWishlist';
                        if (_usesecureurl)
                            url = securehomeUrl + 'mynewtheme/addtowishlist/applyAddToWishlist';
                        jQuery.ajax({
                            type: 'POST',
                            url: url,
                            //data: {'productid': productid},
                            data: {'productid': productid, 'colorcode': currentColor},

                            success: function (data) {


                                data = eval('(' + data + ')');
                                var status = data.status;
                                if (status == "success") {
                                    jQuery(wishlist).text("ADDED TO WISH LIST").css("color", "#D90D3D");
                                }
                                else {
                                    jQuery(this).text(data.errors).css("color", "#D90D3D");
                                }

                            }

                        });

                    }


                });
            }

        });
    </script>
	

    <?php
    }
    else {
        /**************************************************** logic for gift set ***************************************/
        $homeUrl = Mage::getBaseUrl();

        $setDescription = $_conf_product->getDescription();
		$categoryIdGiftSet = Mage::getModel('core/variable')->loadByCode('gift_set_category_id')->getValue('plain');
        //$categoryIdGiftSet = 70;
		//echo $categoryIdGiftSet;
        $_helper = Mage::helper('catalog/output');

        $productCollection = Mage::getModel('catalog/category')->load($categoryIdGiftSet)
            ->getProductCollection()
            ->addAttributeToSelect('*');

        /***************** get all colors from database ***********************/
        $allColors = array();
        $allColorsNames = array();
        $allColorAttribute = Mage::getModel('eav/config')->getAttribute('catalog_product', 'color'); //here, "color" is the attribute_code
        $allColorOptions = $allColorAttribute->getSource()->getAllOptions(true, true);
        foreach ($allColorOptions as $instance) {
            if (!array_key_exists($instance['value'], $allColors)) {
                $allColors[$instance['value']] = $instance['label'];
                $allColorsNames[$instance['label']] = $instance['value'];
            }
        }
        /***************** get all sizes from database ***********************/

        /************ reading all combo products *****************/
        $arComboProduct = array();
        foreach ($productCollection as $_product_single) {

            $productInventoryStatus = "available";

            $_product = Mage::getModel('catalog/product')->load($_product_single->getId());

            $setConfigurablePrice = $_product->getPrice();

            $bundled_product_ids = $resourceModel->getAttributeRawValue($_product->getId(), 'bundle_products', $storeId);

            if (isset($bundled_product_ids))
                $bundled_product_ids = trim($bundled_product_ids);

            $_childProducts = Mage::getModel('catalog/product_type_configurable')->getUsedProducts(null, $_product_single);
            $giftSetAvailable = false;
            foreach ($_childProducts as $simple) {
                $stock = Mage::getModel('cataloginventory/stock_item')->loadByProduct($simple);

                $setSimplePrice = $simple->getPrice();

                $setStock = $stock->getQty();

                if($setStock>0 && $stock->getIsInStock())
                    $giftSetAvailable = true;

                break;
            }

            if(!$giftSetAvailable)
                $productInventoryStatus = "out of stock"; //continue;           // skip this gift set

            /******************************  check if any of the gift set bundled products are out of stock *************************/
            $bundled_product_ids = $resourceModel->getAttributeRawValue($_product->getId(), 'bundle_products', $storeId);

            if (isset($bundled_product_ids))
                $bundled_product_ids = trim($bundled_product_ids);

            $ar_bundled_product_ids = explode(",", $bundled_product_ids);

            $anyBundledOutOfStock = false;
            for ($i = 0; $i < count($ar_bundled_product_ids); $i++) {

                $ar_id_color_code = explode(":", $ar_bundled_product_ids[$i]);          // id:color_code

                $bundle_configurable_id = $ar_id_color_code[0];
                $bundle_color_id = $ar_id_color_code[1];

                $_bundle_product = Mage::getModel('catalog/product')->load(intval($bundle_configurable_id));

                /************** check if all simple products are out of stock or not ********************/
                $allOutOfStock = true;
                $_bundleChildProducts = Mage::getModel('catalog/product_type_configurable')->getUsedProducts(null, $_bundle_product);
                foreach($_bundleChildProducts as $_bundleChildProduct){

                    /************ get color code of simple product and match it with passed color code **************/
                    $bundleChildName = $_bundleChildProduct->getName();
                    $bundleChildColor = $_bundleChildProduct->getAttributeText('color');
                    $bundleChildColorName = substr($bundleChildColor, 0, strpos($bundleChildColor, "|"));
                    $bundleChildColorCode = $allColorsNames[$bundleChildColorName];

                    if($bundleChildColorCode==$bundle_color_id) {

                        $productStock = Mage::getModel('cataloginventory/stock_item')->loadByProduct($_bundleChildProduct);

                        $stock = $productStock->getQty();
                        $inStock = $productStock->getIsInStock();

                        if ($stock > 0 && $inStock) {
                            $allOutOfStock = false;
                            break;
                        }
                    }
                }

                if($allOutOfStock){
                    $anyBundledOutOfStock = true;
                    break;
                }

                /************** check if all simple products are out of stock or not ********************/
            }

            if($anyBundledOutOfStock)
                $productInventoryStatus = "out of stock"; //continue;

            /******************************  check if any of the gift set bundled products are out of stock *************************/


            $_gallery = Mage::getModel('catalog/product')->load($_product->getId())->getMediaGalleryImages();
            if (isset($_gallery)) {

                $thumbnailPath = "";

                foreach ($_gallery as $_image) {
                    $imageLabelData = json_decode(trim($_image->getLabel()), true);
                    $person = $imageLabelData['person'];
                    $image_type = $imageLabelData['image_type'];

                    if($image_type=="landing"){
                        $image = (string)Mage::helper('adaptiveResize/image')->init($_product, 'thumbnail', $_image->getFile());
                        $thumbnail = $imageLabelData['thumbnail'];
                        break;
                    }
                }

                $thumbnailPath = $this->getSkinUrl('images/combo/sets/final/' . $thumbnail);
            }

            $arComboProduct[$_product->getId()] = array(
                "name" => $_product->getName(),
                "price" => $setConfigurablePrice,
                "original_price" => $setSimplePrice,
                "quantity" => round($setStock, 0),
                "description" => $_helper->productAttribute($_product, $_product->getDescription(),'description'),
                "bundle_ids" => $bundled_product_ids,
                "personClass" => "person_" . $person,
                "thumbnailPath" => $thumbnailPath,
                "image" => $image,
                "status" => $productInventoryStatus
            );
        }

        /***************** get all colors from database ***********************/
        $allColors = array();
        $allColorAttribute = Mage::getModel('eav/config')->getAttribute('catalog_product', 'color'); //here, "color" is the attribute_code
        $allColorOptions = $allColorAttribute->getSource()->getAllOptions(true, true);
        foreach ($allColorOptions as $instance) {
            if (!array_key_exists($instance['value'], $allColors)) {
                $allColors[$instance['value']] = $instance['label'];
            }
        }
        /***************** get all sizes from database ***********************/
        $allSizes = array();
        $allSizeAttribute = Mage::getModel('eav/config')->getAttribute('catalog_product', 'size'); //here, "color" is the attribute_code
        $allSizeOptions = $allSizeAttribute->getSource()->getAllOptions(true, true);
        foreach ($allSizeOptions as $instance) {

            if (is_numeric($instance['label']) && intval($instance['label']) > 12)
                continue;

            if (strpos(strtoupper($instance['label']), "T") !== false)
                continue;

            if ($instance['label'] != "")
                $allSizes[$instance['label']] = $instance['value'];
        }

        ?>


        <div class="product_page_container">
            <div class="breadcrumbs">
                <a href="<?php echo $homeUrl; ?>">Home</a> / <a href="<?php echo $homeUrl; ?>gift-sets">$250 GIFT
                    SETS</a> / <span id="bread-set-name"></span>
            </div>
            <div class="gift_sets_container">
                <!--<div class="gift_set_filter">
                    <label>VIEW:</label>
                    <span class="selected">ALL</span>
                    <span>WOMEN</span>
                    <span>MEN</span>
                </div>-->
                <div class="git_sets_list">

                    <?php
                        foreach ($arComboProduct as $id => $comboProduct) {
                            $thumbnailPath = $comboProduct["thumbnailPath"];
                    ?>

                        <div class="gift_set_link <?php echo $comboProduct["personClass"];?> gift_set" rel="<?php echo $id; ?>">
                            <!--top,left-->

                            <p class="pname"><?php echo $comboProduct["name"]; ?><br/>SET</p>

                            <p class="pprice">
                            <?php if($comboProduct["status"]=="out of stock"){ ?>
                                SOLD OUT
                            <?php }else{ ?>
                                $<?php echo round($comboProduct["original_price"], 0); ?>
                            <?php } ?>
                            </p>
                            <img src="<?php echo $thumbnailPath;?>"/>
                        </div>
                    <?php } ?>
                </div>
            </div>
        </div>

        <div class="product_page_container">
            <div class="product_details">

                <div class="slider">
                    <p class="current_slider_product"></p>

                    <div class="current_slider_image"><img src="" class="individual_img"/></div>
                    <!--
                                <div class="flexslider slider">
                                    <ul class="slides">
                                        <li><img src="http://staging.yogasmoga.com/media/catalog/product/cache/1/thumbnail/320x320/17f82f742ffe127f42dca9de82fb58b1/m/y/my-racer-back-amelia-pink-1.jpg" /></li>
                                    </ul>
                                </div>
                    -->
                </div>
                <div class="set_individual_products">
                </div>
                <div class="purchase_box_container">
                    <div class="purchase_box">
                    </div>
                    <div class="product_desc">
                        <div class="desc_box">
                            <p>SET DESCRIPTION</p>

                            <p class="set_description"></p>
                        </div>
                    </div>
                </div>
                <div class="size-charts"></div>
            </div>

        </div>

        <div style="font:12px/15px GothamBook; color:#555; padding: 25px 50px 0px; text-align: left">*To order more than 1 of the same set, please place a separate order.</div>
        <div style="display: none" id="outofstockimage"><img src="<?php echo $this->getSkinUrl('/images/out-of-stock.png');?>"/></div>
        <script type="text/javascript">

            <?php
                foreach($allSizes as $key => $value)
                    echo "allSizes['$key'] = '$value';";

                foreach($allColors as $key => $value)
                    echo "allColors['$key'] = '$value';";

                foreach($arComboProduct as $key => $comboProduct){
                    echo "allComboProducts[$key] = [];";
                    echo "allComboProducts[$key]['status'] = '" . $comboProduct["status"] . "';";
                    echo "allComboProducts[$key]['name'] = '" . $comboProduct["name"] . "';";
                    echo "allComboProducts[$key]['image'] = '" . $comboProduct["image"] . "';";
                    echo "allComboProducts[$key]['description'] = '" . $comboProduct["description"] . "';";
                    echo "allComboProducts[$key]['price'] = '$" . round($comboProduct["price"],2) . "';";
                    echo "allComboProducts[$key]['original_price'] = '$" . round($comboProduct["original_price"],2) . "';";
                    echo "allComboProducts[$key]['quantity'] = '" . $comboProduct["quantity"]. "';";
                    echo "allComboProducts[$key]['bundle_ids'] = '".$comboProduct["bundle_ids"]."';";
                }

                echo "changeProduct(" . $_conf_product->getId() . ")";
            ?>
        </script>
    <?php } ?>