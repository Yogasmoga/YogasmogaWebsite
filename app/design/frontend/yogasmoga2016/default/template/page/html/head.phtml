<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<!-- <script>(function() {
        var _fbq = window._fbq || (window._fbq = []);
        if (!_fbq.loaded) {
            var fbds = document.createElement('script');
            fbds.async = true;
            fbds.src = '//connect.facebook.net/en_US/fbds.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(fbds, s);
            _fbq.loaded = true;
        }
        //_fbq.push(['addPixelId', '1465922433646880']);
		_fbq.push(['addPixelId', '1669605873326757']);
		
    })();
    window._fbq = window._fbq || [];
</script> -->

<?php $serverType = Mage::getModel('core/variable')->loadByCode('server_type')->getValue('plain');
if($serverType == 'production')
{
    ?>
    
<?php } ?>
<meta http-equiv="Content-Type" content="<?php echo $this->getContentType() ?>" />
<?php if(strpos(Mage::helper('core/url')->getCurrentUrl(),"customer/account/login") !== FALSE)
    {
        ?>
        <title>My Account | Yoga Pants &amp; Yoga Gear for Sweaty Workouts | YOGASMOGA</title>
        <meta name="description" content="YOGASMOGA makes the best performance workout clothes for yoga, spin, run, pilates & athletic activities. Advanced Sweat Wicking + Antimicrobial Fabrics." />
        <meta name="keywords" content="Yoga, Yoga Clothes, Yoga Clothing, Yoga Apparel, Yoga Gear, Yoga Accessories, Athletic Apparel,  Women's Athletic Clothing, Men's Athletic Clothing, Women's Yoga Clothing, Men's Yoga Clothing, Clothes for Yoga, Yoga Pants, Sexy Yoga pants, Running Clothes, Spin Clothes, Dance Clothes" />
        <?php
    }
    else
    {
        ?>
            <title><?php echo $this->getTitle() ?></title>
            <meta name="description" content="<?php echo htmlspecialchars($this->getDescription()) ?>" />
            <meta name="keywords" content="<?php echo htmlspecialchars($this->getKeywords()) ?>" />        
        <?php
    }
 ?>
<meta name="robots" content="<?php echo htmlspecialchars($this->getRobots()) ?>" />
<link rel="icon" href="<?php echo $this->getFaviconFile(); ?>" type="image/x-icon" />
<link rel="shortcut icon" href="<?php echo $this->getFaviconFile(); ?>" type="image/x-icon" />
<?php /* speed fix
<link rel="stylesheet" type="text/css" href="<?php echo $this->getSkinUrl('css/fonts.css'); ?>" media="all" />
*/ ?>
<!--[if IE]>
	
<![endif]-->
<!--[if !IE]><!-->
	
 <!--<![endif]-->
<!--[if lt IE 7]>
<script type="text/javascript">
//<![CDATA[
    var BLANK_URL = '<?php echo $this->helper('core/js')->getJsUrl('blank.html') ?>';
    var BLANK_IMG = '<?php echo $this->helper('core/js')->getJsUrl('spacer.gif') ?>';
//]]>
</script>
<![endif]-->
<script type="text/javascript" src="<?php echo $this->getJsUrl('new_jquery/jquery-1.8.2.min.js');?>"></script>
<script type="text/javascript">
    /*DO NOT ALTER *** YOGASMOGA*/(function(e){var t="1861",n=document,r,i,s={http:"http://cdn.mplxtms.com/s/MasterTMS.min.js",https:"https://secure-cdn.mplxtms.com/s/MasterTMS.min.js"},o=s[/\w+/.exec(window.location.protocol)[0]];i=n.createElement("script"),i.type="text/javascript",i.async=!0,i.src=o+"#"+t,r=n.getElementsByTagName("script")[0],r.parentNode.insertBefore(i,r),i.readyState?i.onreadystatechange=function(){if(i.readyState==="loaded"||i.readyState==="complete")i.onreadystatechange=null}:i.onload=function(){try{e()}catch(t){}}})(function(){});
</script>

<?php echo $this->getCssJsHtml() ?>
<?php echo $this->getChildHtml() ?>
<?php echo $this->helper('core/js')->getTranslatorScript() ?>
<?php echo $this->getIncludes() ?>

<!-- New Dynamic Facebook Open Graph Tag -->
<?php 
$gender = "Female";
if(Mage::app()->getRequest()->getControllerName()=='product'){ 
$currentUrl = Mage::helper('core/url')->getCurrentUrl();
           $categoryName = explode('/', $currentUrl);
           $urlKey = $categoryName[3];
		   if($urlKey=='men'){
			$gender = "Male";
		   }
$color   = $_GET['color'];
$_product = Mage::getModel('catalog/product')->load(Mage::registry('current_product')->getId());
$_gallery = Mage::getModel('catalog/product')->load($_product->getId())->getMediaGalleryImages();

if($color){
//get color array
$write = Mage::getSingleton('core/resource')->getConnection('core_read');
$readresult=$write->query("SELECT eaov.value AS 'Attribute', eaov.option_id AS 'Value' FROM eav_attribute ea, eav_attribute_option eao, eav_attribute_option_value eaov WHERE ea.attribute_id = eao.attribute_id AND eao.option_id = eaov.option_id AND eaov.store_id = 0 AND ea.attribute_code='color' AND eao.option_id = $color  ORDER BY eao.sort_order,eaov.value");
$colorIndexArr = array();

while ($row = $readresult->fetch() ) {
	$clrinfo[$row['Value']] = $row['Attribute'];
	}
$colorname = ' - '.$clrinfo[$color];
}


$imageArr = array();
foreach($_gallery as $_image)
{
	$imgdata = json_decode(trim($_image->getLabel()), true);
	$colorId = $imgdata['color'];
	$color   = $_GET['color'];
	if($color){
		if($imgdata['type'] == 'product image' && $imgdata['color'] == $color)
		{

			if(count($imageArr[$colorId])<=3)
			{

			array_push($imageArr,(string)Mage::helper('catalog/image')->init($_product,'image',$_image->getFile())->constrainOnly(TRUE)->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(400)->setQuality(91));

			}
		}
	}else{

		if($imgdata['type'] == 'product image')
		{

			if(count($imageArr[$colorId])<=3)
			{

			array_push($imageArr,(string)Mage::helper('catalog/image')->init($_product,'image',$_image->getFile())->constrainOnly(TRUE)->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(400)->setQuality(91));
			break;

			}
		}

	}

}
?>
<meta property="og:url"  content="<?php echo Mage::helper('core/url')->getCurrentUrl() ?>"/>
<meta property="og:type"  content="product"/>
<meta property="og:title"  content="<?php echo $_product->getName()?><?=$colorname?> | YOGASMOGA.COM"/>
<meta property="og:description"  content="<?php echo $_product->getDescription();?>"/>
<meta property="og:image"  content="<?=$imageArr[0]?>"/>
<meta property="og:site_name"  content="YOGASMOGA"/>
<meta property="og:price:amount"  content="<?php echo number_format(Mage::getModel('catalog/product')->load(Mage::registry('current_product')->getId())->getPrice(),2); ?>"/>
<meta property="og:product:target_gender"  content="<?php echo $gender;?>"/>
<meta property="og:price:currency" content="USD" />
<meta property="og:availability" content="instock" />
<?php 
} else{ ?>
<meta property="og:url"  content="<?php echo Mage::helper('core/url')->getCurrentUrl() ?>"/>
<meta property="og:type"  content="website"/>
<meta property="og:title"  content="<?php echo $this->getTitle() ?>"/>
<meta property="og:description"  content="<?php echo htmlspecialchars($this->getDescription()) ?>"/>
<meta property="og:image"  content="<?php if(Mage::app()->getFrontController()->getRequest()->getRouteName() == 'cms')
            {
            echo $this->getSkinUrl('images/ys_twitter_women.jpg');
            }
       if($this->getRequest()->getControllerName()=='category')
	   {

           $categoryId = Mage::registry('current_category')->getId();
           $category = Mage::getModel('catalog/category')->load($categoryId);

           $currentUrl = Mage::helper('core/url')->getCurrentUrl();
           $categoryName = explode('/', $currentUrl);
           $urlKey = $categoryName[3];


           if($category->getImageUrl()){
            echo $category->getImageUrl();
            }
           else{
               if(strtolower($urlKey) == 'women'){
                   echo $this->getSkinUrl('images/ys_twitter_women.jpg');
               }
               else{
                   echo $this->getSkinUrl('images/ys_twitter_men.jpg');
               }

           }
       }
	   if($this->getRequest()->getControllerName()=='product'){
            echo $imageArr[0];
        }
        
?>"/>
<meta property="og:site_name"  content="YOGASMOGA"/>
<?php } ?>
<!-- New Dynamic Facebook Open Graph Tag -->
<!--twitter cards meta -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@YOGASMOGA">
<meta name="twitter:title" content="<?php echo $this->getTitle() ?>">
<meta name="twitter:description" content="<?php echo htmlspecialchars($this->getDescription()) ?>">
<meta name="twitter:image"
      content="<?php if(Mage::app()->getFrontController()->getRequest()->getRouteName() == 'cms')
            {
            echo $this->getSkinUrl('images/ys_twitter_women.jpg');
            }
       if($this->getRequest()->getControllerName()=='category'){

           $categoryId = Mage::registry('current_category')->getId();
           $category = Mage::getModel('catalog/category')->load($categoryId);

           $currentUrl = Mage::helper('core/url')->getCurrentUrl();
           $categoryName = explode('/', $currentUrl);
           $urlKey = $categoryName[3];


           if($category->getImageUrl()){
            echo $category->getImageUrl();
            }
           else{
               if(strtolower($urlKey) == 'women'){
                   echo $this->getSkinUrl('images/ys_twitter_women.jpg');
               }
               else{
                   echo $this->getSkinUrl('images/ys_twitter_men.jpg');
               }

           }
       }
        if($this->getRequest()->getControllerName()=='product'){
            echo $imageArr[0];
        }
?>">
<!--twitter cards meta, ends -->

<?php /*
<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>jquery/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>jquery/myscripts.js"></script>
<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>jquery/mywatermark.js"></script>
<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>jquery/globalheader.js"></script>
<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>jquery/globalvariables.js"></script>
<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>jquery/sidenavigation.js"></script>
<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>jquery/fullscreen.js"></script>
<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>jquery/mynewsletter.js"></script>
<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>jquery/jquery.quovolver.js"></script>
<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>jquery/jquery.pagescroller.lite.js"></script>
<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>jquery/myvalidations.js"></script>
<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS); ?>jquery/globalsearch.js"></script>
*/ ?>
<?php
    if(strpos(Mage::helper('core/http')->getHttpUserAgent(), "iPad"))
    {
        ?>
            <script type="text/javascript">
                _onipad = true;
            </script>
            <link rel="stylesheet" type="text/css" href="<?php echo $this->getSkinUrl('css/ipad.css'); ?>" media="all" />
        <?php      
    }
    else
    {
        ?>
        <link rel="stylesheet" type="text/css" href="<?php echo $this->getSkinUrl('css/nonipad.css'); ?>" media="all" />
        <?php
    }
?>
<script type="text/javascript" language="javascript">
    jQuery.noConflict();
    var homeUrl = '<?php echo Mage::helper('core/url')->getHomeUrl() ?>';
    var securehomeUrl = '<?php echo Mage::getUrl('',array('_secure'=>true)); ?>';
    var skinUrl = '<?php echo $this->getSkinUrl('') ?>';
    var mediaUrl = '<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA); ?>';
    //console.log(skinUrl);
</script>
<?php $serverType = Mage::getModel('core/variable')->loadByCode('server_type')->getValue('plain');
if($serverType == 'production')
{
?>
<script type="text/javascript">
adroll_conversion_value_in_dollars = 'ADVERTISERS VARIABLE'; 
adroll_custom_data = {"ORDER_ID": "ADVERTISERS VARIABLE"}
</script>
<?php echo $this->getChildHtml('before_head_end') ?>

<?php } ?>



