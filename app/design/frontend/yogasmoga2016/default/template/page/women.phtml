<?php
/**
 *
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * Template for Mage_Page_Block_Html
 */
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<?php echo $this->getLang() ?>"
      lang="<?php echo $this->getLang() ?>">
<head>
    <?php
    if ($this->getRequest()->getParam('video') == 'true') {
        ?>
        <meta property="og:image"
              content="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA); ?>wysiwyg/homepage/video/youtube_fbthumb01.png"/>
        <meta property="og:image"
              content="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA); ?>wysiwyg/homepage/video/youtube_fbthumb02.png"/>
        <meta property="og:image"
              content="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA); ?>wysiwyg/homepage/video/youtube_fbthumb03.png"/>
        <meta property="og:title" content="Yoga Clothing Mens - Sweat Wicking Performance | YOGASMOGA"/>
        <meta property="og:description"
              content="YOGASMOGA makes the best mens performance and workout clothing for yoga, spin, running and more. Featuring Advanced Sweat Wicking & Antimicrobial. Free Shipping to US & Canada"/>
        <?php
    } else {
        ?>
        <meta property="og:image"
              content="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA); ?>wysiwyg/homepage/main_section/fb/facebook-cache-update-01.jpg"/>
        <meta property="og:image"
              content="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA); ?>wysiwyg/homepage/main_section/fb/facebook-cache-update-02.jpg"/>
        <meta property="og:image"
              content="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA); ?>wysiwyg/homepage/main_section/fb/facebook-cache-update-03.jpg"/>
        <meta property="og:title" content="Yoga Clothing Mens - Sweat Wicking Performance | YOGASMOGA"/>
        <meta property="og:description"
              content="YOGASMOGA makes the best mens performance and workout clothing for yoga, spin, running and more. Featuring Advanced Sweat Wicking & Antimicrobial. Free Shipping to US & Canada"/>
        <?php
    }
    ?>

    <?php echo $this->getChildHtml('head') ?>

    <?php
    //if(Mage::getSingleton('core/session')->getShowVideo())
    if ($this->getRequest()->getParam('video') == 'true') {
        //Mage::getSingleton('core/session')->setShowVideo(false);
        ?>
        <script type="text/javascript">
            var loc = window.location;
            history.replaceState("", document.title, loc.pathname + "breathe");
            jQuery(window).load(function () {
                setTimeout(function () {
                    $j("#hmpagevideo").trigger('click')
                }, 1000);
            });
        </script>
        <?php
    }
    ?>
    <script type="text/javascript">
        jQuery(window).load(function () {
            jQuery("div.showloading").removeClass('showloading');
            setTimeout(function () {
                setfullscreenheight();
                jQuery(window).trigger("resize");
            }, 5);
            var bannerImg = document.getElementById("bannerimg").complete;
            if (bannerImg) {
//            jQuery(".share-strip, .new-arrivals-block").animate({opacity:1},100);
            }
            jQuery('body').css('overflow', 'auto');
//        jQuery('.namaskar-overlay1').fadeOut('slow');
        });
        jQuery(document).ready(function () {
            jQuery('.namaskar-overlay1').fadeOut('slow');
            jQuery(".share-strip, .new-arrivals-block").animate({opacity: 1}, 100);
            setTimeout(function () {
                jQuery("div.page-overlayy").remove();
                jQuery("body").css('overflow', 'auto');
            }, 500);
        });
    </script>
    <div class="namaskar-overlay1">&nbsp;</div>
</head>
<body class="<?php echo $this->getBodyClass() ? $this->getBodyClass() : '' ?>"
      style="margin-right:17px;overflow:hidden;">
<?php echo $this->getChildHtml('after_body_start') ?>
<div class="wrapper">
    <div class="page-overlayy" style="background:#fff; position:fixed; top:0; left:0; right:0; bottom:0; z-index:999;">
        &nbsp;</div>
    <?php echo $this->getChildHtml('global_notices') ?>
    <div class="shopping-cart">

    </div>
    <div class="page">
        <?php echo $this->getChildHtml('header') ?>
        <div id="pagecontainer">
            <h1 style="display:none;">Women</h1>
            <!-- sliderBanner -->
            <div class="flexslider showloading cat-slide" id="bucket1_slider">
                <ul class="slides">

                    <li onClick="window.location='/men/tops/huron-hoodie?color=297';" style="background: url('<?php echo $this->getSkinUrl('images/ys-contest_02.jpg') ?>'); background-size: cover;cursor:pointer;">

						<?php if(false){?>

                        <div class="mens-slider">


                            <div class="over-the-slide">
                                <div style="text-align:center">
                                    <span class="hero-slide-subtitle">Featuring collection</span>
                                    <div class="hero-slide-title" style="text-transform: uppercase; color: #fff;">
                                        City Run<br/>
                                    </div>
                                    <div class="hero-slide-bodytext">
                                        <p>Neque porro quisquam est qui
                                            dolorem ipsum quita dolor sit amet,
                                            consectetur, adipisci velit.</p>

                                        <p>donec facilisis, orci vel congue
                                            gravida, justo metus tempor mi, ac
                                            volutpat lacus enim sed justo.</p>

                                        <p>Click on the product to shop</p>

                                    </div>

                                    <div class="hero-slide-cta">
                                        <a class="shop-link" href="/men/tops/huron-hoodie?color=297">Shop the Look</a>
                                    </div>
                                </div>

                            </div>
                            <div style="width:66.75%;height:100%;position:absolute;right:0;top:0;bottom:0; background: url('<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA) . 'wysiwyg/new-design-images/women-page/oria-women-new.jpg' ?>'); background-size: cover;cursor:pointer;">

                            </div>

                        </div>
						<?php }?>

                    </li>
					<?php if(false){?>
                    <li onClick="window.location='/men/tops/huron-hoodie?color=297';" style="background: url('<?php/* echo $this->getSkinUrl('images/mens-white-background.png')*/ ?>'); background-size: cover;cursor:pointer;">
                        <div class="mens-slider">


                            <div class="over-the-slide">
                                <div style="text-align:center">
                                    <span class="hero-slide-subtitle">Featuring collection</span>
                                    <div class="hero-slide-title" style="text-transform: uppercase; color: #fff;">
                                        City Run<br/>
                                    </div>
                                    <div class="hero-slide-bodytext">
                                        <p>Neque porro quisquam est qui
                                            dolorem ipsum quita dolor sit amet,
                                            consectetur, adipisci velit.</p>

                                        <p>Donec facilisis, orci vel congue
                                            gravida, justo metus tempor mi, ac
                                            volutpat lacus enim sed justo.</p>

                                        <p>Click on the product to shop</p>

                                    </div>

                                    <div class="hero-slide-cta">
                                        <a class="shop-link" href="/men/tops/huron-hoodie?color=297">Shop the Look</a>
                                    </div>
                                </div>

                            </div>
                            <div style="width:66.75%;height:100%;position:absolute;right:0;top:0;bottom:0; background: url('<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA) . 'wysiwyg/new-design-images/women-page/oria-women-new.jpg' ?>'); background-size: cover;cursor:pointer;">

                            </div>

                        </div>

                    </li>
					<?php }?>


                </ul>
            </div>
            <!-- sliderBanner -->

            <!-- signup new -->
            <!--<div class="share-strip">
                <div class="sign-up-new">

                    <a href="javascript:void(0)">Sign up</a><span>&amp; WEâ€™LL SURPRISE YOU</span>

                </div>
            </div>-->
            <!-- signup new -->

            <?php
            $currentCategoryId = Mage::registry('current_category')->getId();
            //$categoriesWithNoFilterVariable = array(8,12,29,30,31,32,33,38,39,40,46,50);
            $categoriesWithNoFilterVariable = Mage::getModel('core/variable')->loadByCode('no_filter_categories')->getValue('plain');
            $categoriesWithNoFilter = explode(",", $categoriesWithNoFilterVariable);
            $showSizeFilter = !in_array($currentCategoryId, $categoriesWithNoFilter);
            if($showSizeFilter){
                ?>
                <div id="div_sizes" class="sz_filter">&nbsp;</div>
                <!-- category filter -->
                <div id="div_cats" class="ct_filter"></div>
            <?php } ?>

            <div class="clear-fix"></div>







            <!-- ProductListing Part -->

            <div class="new_arrivals gridWrap new-arrivals-block" style="width:100%; margin:0 auto; position: relative;background:#fff!important;">

                <?php $categoryIds = json_decode(trim(Mage::getModel('core/variable')->loadByCode('women_landing_category_ids')->getValue('plain')), true);

                $categoryId_newcollection = $categoryIds['new_collection'];
                $categoryId_quickview = $categoryIds['quick_view'];
                ?>
                <?php
                $newcollection = Mage::getModel('catalog/category')->load($categoryId_newcollection);
                $newarrivals = Mage::getModel('catalog/category')->load($categoryId_quickview);
                ?>

                <div class="shop-col-desc">
                    <h2>
                        <span class="na-head">MID-SUMMER NEW ARRIVALS</span>
                        <!--<span class="na-link"><a href="<?php echo $newcollection->getUrl(); ?>">Shop New
                            Collection</a></span>-->
                    </h2>
                    <p class="na-subhead">Activewear for 80f up&mdash;our AURUM&reg; tops for wicking moisture,<br/>so you can stay on track longer.</p>
                </div>
                <div class="productContbox">

                    <?php
                    //retrieve color
                    $write = Mage::getSingleton('core/resource')->getConnection('core_read');
                    $readresult = $write->query("SELECT eaov.value AS 'Attribute', eaov.option_id AS 'Value' FROM eav_attribute ea, eav_attribute_option eao, eav_attribute_option_value eaov WHERE ea.attribute_id = eao.attribute_id AND eao.option_id = eaov.option_id AND eaov.store_id = 0 AND ea.attribute_code='color'");
                    while ($row = $readresult->fetch()) {
                        $clrinfo[$row['Value']] = $row['Attribute'];
                    }
                    //                        $categoryIds = json_decode(trim(Mage::getModel('core/variable')->loadByCode('women_landing_category_ids')->getValue('plain')), true);
                    //
                    //                        $categoryId = $categoryIds['new_arrivals'];

                    //$newarrivals = Mage::getModel('catalog/category')->load($categoryId);


                    $productCollection = $newarrivals->getProductCollection()->addAttributeToFilter('type_id', 'configurable')->addAttributeToSelect('*');
                    $quickviewproducts = array();
                    $simpleproductarr = array();//Added By FK
                    $fcolorKey = array();//Added By FK
                    $fcolorValue = array();//Added By FK
                    foreach ($productCollection as $_product) {

                        $filterName = $_product->getAttributeText('color_filter');
                        $simpleproductarr['id'] =  $_product->getId();
                        $parentIds = Mage::getResourceSingleton('catalog/product_type_configurable')->getParentIdsByChild($simpleproductarr['id']);
                        $simpleproductarr['filter_color'] = $_product->getColorFilter();//Added By FK
                        $fcolorKey[] = $_product->getColorFilter();//Added By FK
                        $fcolorValue[] = $filterName;//Added By FK

                        $_gallery = Mage::getModel('catalog/product')->load($_product->getId())->getMediaGalleryImages();
                        $grayimgage = '';
                        $frontimgage = '';
                        foreach ($_gallery as $_image) {
                            $imgdata = json_decode(trim($_image->getLabel()), true);
                            if ($imgdata == NULL) {
                                continue;
                            }

                            if (strcasecmp($imgdata['type'], "grey background") == 0 && $imgdata['color'] != '' && $imgdata['quick_view_position'] != '') {
                                $grayimgage = $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile())->constrainOnly(TRUE)->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(800, 800)->setQuality(90);

//$quickviewproducts[$imgdata['quick_view_position']]['position'] = $imgdata['quick_view_position'];
                                $quickviewproducts[$imgdata['quick_view_position']]['id'] = $_product->getId();
                                $quickviewproducts[$imgdata['quick_view_position']]['name'] = $_product->getName();
                                $quickviewproducts[$imgdata['quick_view_position']]['color'] = $imgdata['color'];
                                $quickviewproducts[$imgdata['quick_view_position']]['price'] = round($_product->getPrice(), 2);
                                $quickviewproducts[$imgdata['quick_view_position']]['imgurl'] = (string)$grayimgage;
                                $quickviewproducts[$imgdata['quick_view_position']]['url'] = $_product->getProductUrl();

                                foreach ($_gallery as $_imageFR) {
                                    $imgdataFR = json_decode(trim($_imageFR->getLabel()), true);
                                    if ($imgdataFR == NULL) {
                                        continue;
                                    }

                                    if($imgdataFR['type'] == 'product image' && $imgdataFR['color'] == $imgdata['color'] && !isset($quickviewproducts[$imgdata['quick_view_position']]['frontimgurl']))
                                    {
                                        $frontimgage = $this->helper('catalog/image')->init($_product, 'thumbnail', $_imageFR->getFile())->constrainOnly(TRUE)->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(800, 800)->setQuality(90);
                                        $quickviewproducts[$imgdata['quick_view_position']]['frontimgurl'] = (string)$frontimgage;
                                    }
                                }

                                if (count($quickviewproducts) == 8) break;
                            }

                        }
                    }


                    ksort($quickviewproducts);


                    // Size Filter added.



                    $confProduct = Mage::getModel('catalog/product')->load($simpleproductarr['parentid']);
                    //show html of the product


                    /**************** size filter *****************/
                    $alphabeticSkuSizes = array();
                    $productColorIndex=0;
                    /**************** size filter *****************/
                    ++$productColorIndex;

                    $confProductForSku = Mage::getModel('catalog/product_type_configurable')->setProduct($confProduct);

                    $skuSizes = array();
                    $simpleCollectionForSku = $confProductForSku->getUsedProductCollection()->addAttributeToSelect('*')->addFieldToFilter(array(array('attribute'=>'color','eq'=>$simpleproductarr['color'])));


                    $characterSizeFound = false;
                    foreach($simpleCollectionForSku as $simpleProductForSku){
                        //$sku = $simpleProductForSku->getId();
                        $filterColorName = $simpleProductForSku->getAttributeText('color');
                        $filterColorName = substr($filterColorName, 0, strpos($filterColorName, "|"));
                        $size = $simpleProductForSku->getAttributeText('size');
                        //$stock = (int)Mage::getModel('cataloginventory/stock_item')->loadByProduct($simpleProductForSku)->getQty();
                        $stock = (int)Mage::getModel('cataloginventory/stock_item')->loadByProduct($simpleProductForSku)->getIsInStock();
                        if(!isset($skuSizes[$filterColorName]))
                            $skuSizes[$filterColorName] = array();

                        if(isset($size) && strlen(trim($size))>0) {
                            $allSkuSizes[] = $size;
                            if ($stock > 0)
                                $skuSizes[$filterColorName][] = $size;
                        }
                    }
                    /**************** size filter *****************/

                    /****************** size filter **********************************/
                    $productColorName = $clrinfo[$simpleproductarr['color']];
                    $arColorSizes = array();
                    foreach($skuSizes as $keyColor => $sizes) {

                        if ($keyColor == $productColorName) {
                            $strSizes = implode(",", $sizes);
                            break;
                        }
                    }
                    //echo $strSizes;
                    /****************** size filter **********************************/
                    /********************** category filter *********************/
                    $cats = $confProduct->getCategoryIds();
                    $allcats = array_unique(array_merge($allcats,$cats));
                    $catsids = implode(",", $cats);

                    /*------------*/

                    //$simpleproductarr['filter_color'];
                    //$simpleproductarr['filter_data']



                    /********************** category filter *********************/



                    // Size Filter end.


                    ?>
                    <?php
                    $i = 1;
                    $position = array(Mage::getStoreConfig('tab1/general/smogi', Mage::app()->getStore()->getId()));
                    $finalPos = implode(',',$position);
                    foreach ($quickviewproducts as $_product) {
                        if($i == (int)$finalPos[0]){
                            ?>

                            <!-- size filters -->
                            <div class="productCont prodduct_horizontal" color="<?php echo $simpleproductarr['filter_color']; ?>" dd=" <?php echo $finalPos[0];?>">
                                <!-- size filters -->
                                <div class="prod-img">
                                    <a href="<?php echo $_product['url'].'?color='.$_product['color'];?>">
                                        <img class="prd-image" src="<?php echo $_product['imgurl']; ?>"/>
                                        <img class="prd-image" src="<?php echo $_product['frontimgurl']; ?>"/>
                                    </a>
                                </div>
                                <div class="caption">

                                    <a href="<?php echo $_product['url'].'?color='.$_product['color'];?>"><?php echo $_product['name'].'<br/>';?></a><span><?php echo $clrinfo[$_product['color']]; ?>&mdash;$<?php echo $_product['price']; ?></span>

                                </div>
                            </div>

                        <?php }
                        elseif($i == (int)$finalPos[2]){
                        ?>

                        <!-- size filters -->
                        <div class="productCont prodduct_horizontal" color="<?php echo $simpleproductarr['filter_color']; ?>"  dd=" <?php echo $finalPos[1];?>">
                            <!-- size filters -->
                            <div class="prod-img">
                                <a href="<?php echo $_product['url'].'?color='.$_product['color'];?>">
                                    <img class="prd-image" src="<?php echo $_product['imgurl']; ?>"/>
                                    <img class="prd-image" src="<?php echo $_product['frontimgurl']; ?>"/>
                                </a>
                            </div>
                            <div class="caption">

                                <a href="<?php echo $_product['url'].'?color='.$_product['color'];?>"><?php echo $_product['name'].'<br/>';?></a><span><?php echo $clrinfo[$_product['color']]; ?>&mdash;$<?php echo $_product['price']; ?></span>

                            </div>
                        </div>
                    <?php } else{ ?>
                            <!-- size filters -->
                            <div class="productCont" color="<?php echo $simpleproductarr['filter_color']; ?>">
                                <!-- size filters -->
                                <div class="prod-img">
                                    <a href="<?php echo $_product['url'].'?color='.$_product['color'];?>">
                                        <img class="prd-image" src="<?php echo $_product['imgurl']; ?>"/>
                                        <img class="prd-image" src="<?php echo $_product['frontimgurl']; ?>"/>
                                    </a>
                                </div>
                                <div class="caption">

                                    <a href="<?php echo $_product['url'].'?color='.$_product['color'];?>"><?php echo $_product['name'].'<br/>';?></a><span><?php echo $clrinfo[$_product['color']]; ?>&mdash;$<?php echo $_product['price']; ?></span>

                                </div>
                            </div>

                        <?php } ?>

                        <?php $i++; } ?>

                </div>
            </div>
            <!-- ProductListing Part -->
            <div class="clear-fix"></div>
            <!-- Feature Product -->
<?php
            if($showSizeFilter){
            /************** size filter ***********************/
            if(isset($allSkuSizes) && count($allSkuSizes)>0)
            $allSkuSizes = array_unique($allSkuSizes);

            $arProductAllSizes = array();
            $attribute = Mage::getModel('eav/config')->getAttribute('catalog_product', 'size'); //here, "color" is the attribute_code
            $allOptions = $attribute->getSource()->getAllOptions(true, true);
            foreach ($allOptions as $instance) {
            if ($instance['label'] != "" && strpos($instance['label'], "T")===false)
            $arProductAllSizes[] = $instance['label'];
            }



            $finalcolorfilter = array_combine($fcolorKey,$fcolorValue);

            //echo "<pre/>";
            //print_r($finalcolorfilter);



            /************** size filter ***********************/

            ?>
            <!-- ********************************* checkbox filter ********************** -->
            <script type="text/javascript">
                var arAllSizes = Array();
                var arProductSizes = Array();
                var arAllCats = Array();
                var arProductCats = {};//Array();

                var productColorIndex;

                productColorIndex = "<?php echo $productColorIndex;?>";

                <?php
                    foreach($allSkuSizes as $size){
                ?>
                arProductSizes.push("<?php echo $size;?>");
                <?php
                    }
                    foreach($arProductAllSizes as $size){
                ?>
                arAllSizes.push("<?php echo $size;?>");
                <?php
                    }
                ?>

                <?php
                foreach($finalcolorfilter as $id => $name){
                ?>
                arProductCats["<?php echo $id;?>"] = "<?php echo $name;?>";
                <?php
                }
                foreach($allcats as $catid){
                ?>
                arAllCats.push("<?php echo $catid;?>");
                <?php
                }
                ?>
                console.log(JSON.stringify(arProductCats));
                console.log(JSON.stringify(arAllCats));

            </script>
            <script src="<?php echo  Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_JS);?>new_jquery/size-filter-new.js"></script>

            <!-- ********************************* checkbox filter ********************** -->
            <?php } ?>

        </div>
        <?php echo $this->getChildHtml('footer'); ?>
    </div>
    <?php echo $this->getChildHtml('before_body_end'); ?>
</div>
</div>
<?php echo $this->getAbsoluteFooter() ?>
</body>
</html>
