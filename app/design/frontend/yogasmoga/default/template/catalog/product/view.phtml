<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product view template
 *
 * @see Mage_Catalog_Block_Product_View
 * @see Mage_Review_Block_Product_View
 */
?>
<?php $_helper = $this->helper('catalog/output'); ?>
<?php $_product = $this->getProduct(); ?>
<?php $_product = Mage::getModel('catalog/product')->load($_product->getId()); ?>
<?php
    /*
<div id="messages_product_view"><?php echo $this->getMessagesBlock()->getGroupedHtml() ?></div>
*/ 
?>
<?php
    //$pts = Mage::helper('rewardpoints/data')->getPointsOnOrder();
    //echo Mage::helper('rewardpoints/data')->getEquivalence($pts);
    //echo $pts;
    $cats = $_product->getCategoryIds();
    $categoryid = Mage::getModel('catalog/category')->load($cats[0])->getId();
    $categoryurl = Mage::getModel("catalog/category")->load($categoryid)->getUrl();
    //echo $categoryid;
    $breadcrumb = '&lt;&nbsp;<a href="'.Mage::helper('core/url')->getHomeUrl().'">Home</a>';
    $breadcrumb .= '&nbsp;&lt;&nbsp;<a href="'.Mage::getModel("catalog/category")->load($categoryid)->getUrl().'">'.Mage::getModel("catalog/category")->load($categoryid)->getName().'</a>';
    //$breadcrumb .= '&nbsp;&lt;&nbsp;<a href="'.Mage::getModel("catalog/category")->load(Mage::getModel('catalog/layer')->getCurrentCategory()->getId())->getUrl().'">'.Mage::getModel("catalog/category")->load(Mage::getModel('catalog/layer')->getCurrentCategory()->getId())->getName().'</a>';
    if($this->getRequest()->getParam('from') == 'dressingroom')
        $breadcrumb .= '&nbsp;&lt;&nbsp;<a href="'.Mage::getModel("catalog/category")->load(Mage::getModel('catalog/layer')->getCurrentCategory()->getId())->getUrl().'#dressingroom">DRESSING ROOM</a>';
    else
        $breadcrumb .= '&nbsp;&lt;&nbsp;<a href="'.Mage::getModel("catalog/category")->load(Mage::getModel('catalog/layer')->getCurrentCategory()->getId())->getUrl().'#productgrid">PRODUCT GRID</a>';
    
        
    $productname = $_helper->productAttribute($_product, $_product->getName(), 'name');
    $productid = $_product->getId();
    $_rewardpointsearned = 0.1;
    $price = $_product->getSpecialPrice();
    if($price == "")
        $price = $_product->getPrice();
    $price = round($price,2);
      if (floor($price)==$price)
        $price = floor($price);
    $productrewardpoints = floor($price * $_rewardpointsearned);
    $productprice = "$".$price;
    
    $_childproducts = Mage::getModel('catalog/product_type_configurable')->getUsedProducts(null, $_product);
    $_gallery = Mage::getModel('catalog/product')->load($_product->getId())->getMediaGalleryImages();
    $productcolorinfo = array();
    foreach($_childproducts as $_childproduct)
    {
        //echo Mage::helper('rewardpoints/data')->getProductPointsText($_childproduct, false, false);
        //echo Mage::getModel('cataloginventory/stock_item')->loadByProduct($_childproduct)->getQty();
        $temp = $_childproduct->getAttributeText('color');
        if(strpos($temp,"|") !== FALSE)
        {
            $hexcodes = substr($temp, strpos($temp,"|") + 1);
            $hexcodes = explode(",", $hexcodes);
            $temp = substr($temp, 0, strpos($temp,"|"));
            if(!isset($productcolorinfo[$temp]))
                $productcolorinfo[$temp] = array();
            $productcolorinfo[$temp]['hex'] = $hexcodes;
            $productcolorinfo[$temp]['value'] = Mage::getResourceModel('catalog/product')->getAttributeRawValue($_childproduct->getId(), 'color', Mage::app()->getStore()->getStoreId());
            //if(!array_key_exists('hex', $productcolorinfo[$temp]))
//            {
//                $hexcodes = explode(",", $hexcodes);
//                $productcolorinfo[$temp]['hex'] = $hexcodes;
//            }
            //if(count($productcolorinfo[$temp]["images"]) == 0)
//            {
//                $hexcodes = explode(",", $hexcodes);
//                $productcolorinfo[$temp]["hex"] = $hexcodes;
//            }
            //if(!isset($productcolorinfo[$temp]['hex']))
//            {
//                echo $temp;
//                $hexcodes = explode(",", $hexcodes);
//                //$productcolorinfo[$temp]['hex'] = $hexcodes;
//                array_push($productcolorinfo[$temp]['hex'], $hexcodes);   
//            }
        }
        //if(!isset($productcolorinfo[$temp]))
//            $productcolorinfo[$temp] = array();
//        $productcolorinfo[$temp]['rewardpoints'] = Mage::helper('rewardpoints/data')->getProductPointsText($_childproduct, false, false);
//        $productcolorinfo[$temp]['rewardpoints'] = strip_tags($productcolorinfo[$temp]['rewardpoints']);
//        $productcolorinfo[$temp]['rewardpoints'] = trim(substr($productcolorinfo[$temp]['rewardpoints'], strpos($productcolorinfo[$temp]['rewardpoints'], "earn") + strlen("earn"), strpos($productcolorinfo[$temp]['rewardpoints'], "loyalty") - 1 - strlen("loyalty") - strpos($productcolorinfo[$temp]['rewardpoints'], "earn") + strlen("earn")));
        $price = $_childproduct->getSpecialPrice();
        if($price == "")
            $price = $_childproduct->getPrice();
        $price = round($price,2);
          if (floor($price)==$price)
            $price = floor($price);
        
        $rewardpoints = Mage::helper('rewardpoints/data')->getProductPointsText($_childproduct, false, false);
        $rewardpoints = strip_tags($rewardpoints);
        $rewardpoints = trim(substr($rewardpoints, strpos($rewardpoints, "earn") + strlen("earn"), strpos($rewardpoints, "loyalty") - 1 - strlen("loyalty") - strpos($rewardpoints, "earn") + strlen("earn")));
        $temp1 = $_childproduct->getAttributeText('size')."|".Mage::getModel('cataloginventory/stock_item')->loadByProduct($_childproduct)->getQty()."|".$price."|".$rewardpoints;
        //if(array_key_exists("sizes", $productcolorinfo[$temp]))
        if(isset($productcolorinfo[$temp]["sizes"]))
        {
            //echo "pushing";
            array_push($productcolorinfo[$temp]["sizes"], $temp1);
        }
        else
        {
            $productcolorinfo[$temp]["sizes"] = array($temp1);
            if(!isset($productcolorinfo[$temp]["sizes"]))
                echo "not set";    
            foreach($_gallery as $_image)
            {
                //echo "<pre>";
//                print_r($_image);
//                echo "</pre>";
//                break;
                if(str_replace("*", "", $_image->getLabel()) == $temp)
                {
                    
                    //echo $imageurl;
                    $smallimageurl = "_".$this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile())->constrainOnly(TRUE)->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(75, 75);
                    $imageurl = "_".$this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile())->constrainOnly(TRUE)->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(700, 700);
                    $zoomimageurl = "_".$this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile());
                    
                    //if(count($productcolorinfo[$temp]["images"]) == 0)
                    if(!isset($productcolorinfo[$temp]["images"]))
                    {
                        $productcolorinfo[$temp]["images"] = array();
                        $productcolorinfo[$temp]["images"]["small"] = array($smallimageurl);
                        $productcolorinfo[$temp]["images"]["zoom"] = array($zoomimageurl);
                        $productcolorinfo[$temp]["images"]["big"] = array($imageurl);
                        //echo "creating"."<br/>";
                    }
                    else
                        if(count($productcolorinfo[$temp]["images"]["small"]) < 3)
                        {
                            array_push($productcolorinfo[$temp]["images"]["big"], $imageurl);
                            array_push($productcolorinfo[$temp]["images"]["small"], $smallimageurl);
                            //echo "pushing"."<br/>";
                            array_push($productcolorinfo[$temp]["images"]["zoom"], $zoomimageurl);
                        }
                }
            }
        }
    }
    
    $tempproductcolorinfo = array();
    $attribute = Mage::getModel('eav/config')->getAttribute('catalog_product', 'color'); //here, "color" is the attribute_code
    $allOptions = $attribute->getSource()->getAllOptions(true, true);
    foreach ($allOptions as $instance) {
        if(array_key_exists($instance['label'], $productcolorinfo))
        {
            $tempproductcolorinfo[$instance['label']] = $productcolorinfo[$instance['label']];
        }
    }
    $productcolorinfo = $tempproductcolorinfo;
    
    
    $productallsizes = array();
    
    
    $attribute = Mage::getModel('eav/config')->getAttribute('catalog_product', 'size'); //here, "color" is the attribute_code
    $allOptions = $attribute->getSource()->getAllOptions(true, true);
    foreach ($allOptions as $instance) {
        if($instance['label'] != "")
            array_push($productallsizes, array("label" => $instance['label'], "value" => $instance['value']) );
    }
    
    
    //echo "<pre>";
//    print_r($productcolorinfo);
//    echo "</pre>";
    
?>
    
    <div id="productdetails" desc="<?php echo $productname; ?>" class="fullscreen colorbg pgsection">
    <script type="text/javascript">
        var optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);
    </script>
    <script type="text/javascript">
        jQuery(document).ready(function($){
            selectmenulink('<?php echo $categoryurl; ?>');
        });
        _productcolorinfo = new Array();
    <?php
    $configurableAttributeCollection=$_product->getTypeInstance()->getConfigurableAttributes();
    foreach($configurableAttributeCollection as $attribute){
        //echo "Attr-Code:".$attribute->getProductAttribute()->getAttributeCode()."<br/>";
//        echo "Attr-Label:".$attribute->getProductAttribute()->getFrontend()->getLabel()."<br/>";
//        echo "Attr-Id:".$attribute->getProductAttribute()->getId()."<br/>";
        ?>
        _productid = '<?php echo $productid; ?>';
        <?php
        if($attribute->getProductAttribute()->getAttributeCode() == "color")
        {
            ?>
                _colorattributeid = '<?php echo $attribute->getProductAttribute()->getId(); ?>';
            <?php       
        }
        if($attribute->getProductAttribute()->getAttributeCode() == "size")
        {
            ?>
                _sizeattributeid = '<?php echo $attribute->getProductAttribute()->getId(); ?>';
            <?php       
        }
    }
    
    $currentcolorcount = 0;
    foreach($productcolorinfo as $key=>$val)
    {
        ?>
            _productcolorinfo[<?php echo $currentcolorcount; ?>] = new Object();
            _productcolorinfo[<?php echo $currentcolorcount; ?>].color = '<?php echo $key; ?>'; 
            _productcolorinfo[<?php echo $currentcolorcount; ?>].hex = new Array();
            <?php
                for($i = 0; $i < count($val['hex']); $i++)
                {
                    ?>
                        _productcolorinfo[<?php echo $currentcolorcount; ?>].hex[<?php echo $i; ?>] = '<?php echo $val['hex'][$i]; ?>';
                    <?php
                } 
            ?>
            _productcolorinfo[<?php echo $currentcolorcount; ?>].sizes = new Array();
            <?php
                for($i = 0; $i < count($val['sizes']); $i++)
                {
                    ?>
                        _productcolorinfo[<?php echo $currentcolorcount; ?>].sizes[<?php echo $i; ?>] = '<?php echo $val['sizes'][$i]; ?>';
                    <?php
                } 
            ?>
            _productcolorinfo[<?php echo $currentcolorcount; ?>].zoomimages = new Array();
            <?php
                for($i = 0; $i < count($val['images']['zoom']); $i++)
                {
                    ?>
                        _productcolorinfo[<?php echo $currentcolorcount; ?>].zoomimages[<?php echo $i; ?>] = '<?php echo substr($val['images']['zoom'][$i], 1); ?>';
                    <?php
                } 
            ?>
            _productcolorinfo[<?php echo $currentcolorcount; ?>].smallimages = new Array();
            <?php
                for($i = 0; $i < count($val['images']['small']); $i++)
                {
                    ?>
                        _productcolorinfo[<?php echo $currentcolorcount; ?>].smallimages[<?php echo $i; ?>] = '<?php echo substr($val['images']['small'][$i], 1); ?>';
                    <?php
                } 
            ?>
            _productcolorinfo[<?php echo $currentcolorcount; ?>].bigimages = new Array();
            <?php
                for($i = 0; $i < count($val['images']['big']); $i++)
                {
                    ?>
                        _productcolorinfo[<?php echo $currentcolorcount; ?>].bigimages[<?php echo $i; ?>] = '<?php echo substr($val['images']['big'][$i], 1); ?>';
                    <?php
                } 
            ?>
        <?php
        $currentcolorcount++;
    }
?>
    console.log(_productcolorinfo);
    </script>
    <table class="productimagecontainer">
        <tr>
            <td>
                <table class="tdbigimagecontainer">
                    <tr>
                        <td>    
                        </td>
                    </tr>
                </table>    
            </td>
        </tr>
        <tr>
            <td class="tddivider">
                <div>
                    <img src="<?php echo $this->getSkinUrl('images/catalog/product/big_line.png'); ?>" />
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <table class="smallimagecontiner">
                    <tr>
                        
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    <div class="productoptions absoluteproductoptions">
        <table class="productdetailtable normalproductdetail">
            <tr>
                <td>
                    <div class="breadcrumb"><?php echo $breadcrumb; ?></div>
                    <div class="productname"><?php echo $productname; ?></div>
                    <div class="productcost"><?php echo $productprice; ?></div>
                    <div class="shortdesc"><?php echo $_product->getShortDescription(); ?></div>
                    <table class="selectedcolor">
                        <tr>
                            <td>COLOR</td>
                            <td class="selectedcolortext"></td>
                        </tr>
                    </table>
                    <div id="colorcontainer">
                        <?php
                            $first = true;
                            //print_r($productcolorinfo);
                             foreach($productcolorinfo as $key=>$colorinfo)
                            {
                                ?>
                                    <div>
                                        <table color="<?php echo $key; ?>" value="<?php echo $colorinfo['value']; ?>">
                                            <tr>
                                                <?php
                                                    foreach($colorinfo['hex'] as $hex)
                                                    {
                                                        ?>
                                                            <td style="background-color: <?php echo $hex ?>;">
                                                            <div>
                                                                &nbsp;
                                                            </div>                                                
                                                            </td>   
                                                        <?php
                                                    } 
                                                ?>
                                            </tr>
                                            <tr>
                                                <td colspan="<?php echo count($colorinfo['hex']); ?>" <?php if($first) { echo "class='tdselectedcolor'"; $first = false; } ?>>
                                                      
                                                </td>
                                            </tr>
                                        </table>
                                    </div>  
                                <?php
                            }
                        ?>
                    </div>
                    <div style="clear: both;"></div>
                    <table class="selectedsize">
                        <tr>
                            <td>SIZE</td>
                            <td class="sizechartlink"><div><a href="#">Size chart</a></div></td>
                        </tr>
                    </table>
                    <div id="sizecontainer">
                        <table>
                            <tr>
                                <?php
                                    foreach($productallsizes as $size)
                                    {
                                        ?>
                                            <td><div value="<?php echo $size['value']; ?>" size="<?php echo $size['label']; ?>"><?php echo $size['label']; ?></div></td>        
                                        <?php
                                    } 
                                ?>
                            </tr>
                        </table>
                    </div>
                    <table class="fittable">
                        <tr>
                            <td>
                                <div class="hanger"></div>
                            </td>
                            <td class="howdoesitfitlink"><div><a href="#">How does it fit?</a></div></td>
                        </tr>
                    </table>
                    <div class="qty">QTY</div>
                    <div class="sizeselector">
                        <select class="qtyselector">
                            <?php
                                for($i = 0; $i < 21; $i++)
                                {
                                    ?>
                                        <option value="<?php echo $i; ?>"><?php echo $i; ?></option>
                                    <?php
                                } 
                            ?>
                        </select>
                    </div>
                    <div class="divider"></div>
                    <table class="smogibucks">
                        <tr>
                            <td>
                                <div class="smogibuckcount">
                                    <table>
                                        <tr>
                                            <td>
                                                <?php echo $productrewardpoints; ?>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </td>
                            <td class="earnsmogibuckstext">
                                EARN SMOGI BUCKS<br/>WITH THIS PURCHASE
                            </td>
                        </tr>
                    </table>
                    <div id="orderitem" class="addtobag spbutton" imageurl="<?php echo $this->getSkinUrl('images/catalog/product/add_to_bag_off.png'); ?>" downimageurl="<?php echo $this->getSkinUrl('images/catalog/product/add_to_bag_on.png'); ?>"></div>
                    <div id="preorderitem" class="preorderitem spbutton" imageurl="<?php echo $this->getSkinUrl('images/catalog/product/pre_order_this_item.png'); ?>" downimageurl="<?php echo $this->getSkinUrl('images/catalog/product/pre_order_this_item.png'); ?>"></div>
                    <div class="producterrorcontainer">
                        <div class="errormsg">
                        </div>
                    </div>
                    <div class="addtowishlist">
                        <a href="<?php echo Mage::helper('core/url')->getHomeUrl(); ?>wishlist/index/add/product/<?php echo $productid; ?>/">ADD TO WISHLIST +</a>
                    </div>
                </td>
            </tr>
        </table>
    </div>
</div>
<?php
    $productmodel = Mage::getResourceModel('catalog/product');
    $productid = $_product->getId();
    $currentstoreid = Mage::app()->getStore()->getStoreId();
    $dfimages = array();
    $ftimage = "";
    foreach($_gallery as $_image)
    {
        if($_image->getLabel() == "Fabric_Technology_Image")
        {
            $ftimage = $this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile());
            continue;
        }
        if(strpos($_image->getLabel(), "|DF") !== 0)
            continue;
        $temp = str_replace("|DF", "", $_image->getLabel());
        $temp = explode("|", $temp);
        $dfimages[$temp[0]]["url"] = "_".$this->helper('catalog/image')->init($_product, 'thumbnail', $_image->getFile());
        if(isset($temp[1]))
            $dfimages[$temp[0]]["caption"] = $temp[1];
        else
            $dfimages[$temp[0]]["caption"] = "";
    }
    //echo "<pre>";
//    print_r($dfimages);
//    echo "</pre>";
?>

<?php
    $flag = true;
    for($i = 1; $i <= 5; $i++)
    {
        if(!isset($dfimages[$i]))
            $flag = false;
    }
    if($flag)
    {
        if($_product->getAttributeText('design_feature_view') == "Landscape")
        {
            ?>
            <div class="fullscreen colorbg pgsection">
                <table class="fullscreentable">
                    <tr>
                        <td style="padding: 0 50px;">
                            <table class="productdesignfeatures">
                                <tr>
                                    <td style="width: 50%;">
                                       <table style="width: 100%;">
                                            <tr>
                                                <td style="width: 60%;">
                                                    <div size="half">
                                                            <img src="<?php echo substr($dfimages[1]["url"], 1); ?>" alt="<?php echo $dfimages[1]["caption"]; ?>" />
                                                            <div class="caption"><div><?php echo $dfimages[1]["caption"]; ?></div></div>
                                                        <?php /*
                                                        <div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
                                                        */ ?>
                                                    </div>      
                                                </td>
                                                <td style="width: 40%;">
                                                    <div size="half">
                                                            <img src="<?php echo substr($dfimages[2]["url"], 1); ?>" alt="<?php echo $dfimages[2]["caption"]; ?>" />
                                                            <div class="caption"><div><?php echo $dfimages[2]["caption"]; ?></div></div>
                                                        <?php /*
                                                        <div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
                                                        */ ?>
                                                    </div>
                                                </td>
                                            </tr>
                                       </table> 
                                    </td>
                                    <td rowspan="2" style="width: 50%;">
                                        <div size="full">
                                            <img src="<?php echo substr($dfimages[3]["url"], 1); ?>" alt="<?php echo $dfimages[3]["caption"]; ?>" />
                                            <div class="caption"><div><?php echo $dfimages[3]["caption"]; ?></div></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 50%; vertical-align: bottom;">
                                        <table style="width: 100%;">
                                            <tr>
                                                <td style="width: 40%;">
                                                    <div size="half">
                                                            <img src="<?php echo substr($dfimages[4]["url"], 1); ?>" alt="<?php echo $dfimages[4]["caption"]; ?>" />
                                                            <div class="caption"><div><?php echo $dfimages[4]["caption"]; ?></div></div>
                                                        <?php /*
                                                        <div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
                                                        */ ?>
                                                    </div>      
                                                </td>
                                                <td style="width: 60%;">
                                                    <div size="half">
                                                            <img src="<?php echo substr($dfimages[5]["url"], 1); ?>" alt="<?php echo $dfimages[5]["caption"]; ?>" />
                                                            <div class="caption"><div><?php echo $dfimages[5]["caption"]; ?></div></div>
                                                        <?php /*
                                                        <div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
                                                        */ ?>
                                                    </div>
                                                </td>
                                            </tr>
                                       </table> 
                                    </td>
                                </tr>
                            </table>
                            <div class="designfeaturesheadimage landscapefeature"></div>
                        </td>
                    </tr>
                </table>
            </div>
            <?php
        }
        if($_product->getAttributeText('design_feature_view') == "Potrait")
        {
            ?>
            <div class="fullscreen colorbg pgsection">
                <table class="fullscreentable">
                    <tr>
                        <td style="padding: 0 50px;">
                            <table class="productdesignfeatures">
                                <tr>
                                    <td style="width: 33.33%;">
                                       <div size="half">
                                                <img src="<?php echo substr($dfimages[1]["url"], 1); ?>" alt="<?php echo $dfimages[1]["caption"]; ?>" />
                                                <div class="caption"><div><?php echo $dfimages[1]["caption"]; ?></div></div>
                                            <?php /*
                                            <div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
                                            */ ?>
                                        </div> 
                                    </td>
                                    <td rowspan="2" style="width: 33.33%;">
                                        <div size="full">
                                            <img src="<?php echo substr($dfimages[2]["url"], 1); ?>" alt="<?php echo $dfimages[2]["caption"]; ?>" />
                                            <div class="caption"><div><?php echo $dfimages[2]["caption"]; ?></div></div>
                                        </div>
                                    </td>
                                    <td rowspan="2" style="width: 33.33%;">
                                        <div size="full">
                                            <img src="<?php echo substr($dfimages[3]["url"], 1); ?>" alt="<?php echo $dfimages[3]["caption"]; ?>" />
                                            <div class="caption"><div><?php echo $dfimages[3]["caption"]; ?></div></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 33.33%; vertical-align: bottom;">
                                        <table style="width: 100%;">
                                            <tr>
                                                <td style="width: 50%;">
                                                    <div size="half">
                                                            <img src="<?php echo substr($dfimages[4]["url"], 1); ?>" alt="<?php echo $dfimages[4]["caption"]; ?>" />
                                                            <div class="caption"><div><?php echo $dfimages[4]["caption"]; ?></div></div>
                                                        <?php /*
                                                        <div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
                                                        */ ?>
                                                    </div>      
                                                </td>
                                                <td style="width: 50%;">
                                                    <div size="half">
                                                            <img src="<?php echo substr($dfimages[5]["url"], 1); ?>" alt="<?php echo $dfimages[5]["caption"]; ?>" />
                                                            <div class="caption"><div><?php echo $dfimages[5]["caption"]; ?></div></div>
                                                        <?php /*
                                                        <div class="caption"><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_left_imagetext', $currentstoreid); ?></div>
                                                        */ ?>
                                                    </div>
                                                </td>
                                            </tr>
                                       </table> 
                                    </td>
                                </tr>
                            </table>
                            <div class="designfeaturesheadimage potraitfeature"></div>
                        </td>
                    </tr>
                </table>
            </div>
            <?php    
        }        
    }
?>
<?php /*
<?php
     if($_product->getAttributeText('design_feature_view') == "Landscape"  && $productmodel->getAttributeRawValue($productid, 'design_feature_image1', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image2', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image3', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image4', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image5', $currentstoreid) != "")
     {
        ?>
            <div class="fullscreen colorbg pgsection">
                <table class="fullscreentable">
                    <tr>
                        <td style="padding: 0 50px;">
                            <table class="productdesignfeatures">
                                <tr>
                                    <td style="width: 50%;">
                                       <table style="width: 100%;">
                                            <tr>
                                                <td style="width: 60%;">
                                                    <div size="half">
                                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image1', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description1', $currentstoreid); ?>" />
                                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description1', $currentstoreid); ?></div></div>
                                                    </div>      
                                                </td>
                                                <td style="width: 40%;">
                                                    <div size="half">
                                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image2', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description2', $currentstoreid); ?>" />
                                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description2', $currentstoreid); ?></div></div>
                                                    </div>
                                                </td>
                                            </tr>
                                       </table> 
                                    </td>
                                    <td rowspan="2" style="width: 50%;">
                                        <div size="full">
                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image3', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description3', $currentstoreid); ?>" />
                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description3', $currentstoreid); ?></div></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 50%; vertical-align: bottom;">
                                        <table style="width: 100%;">
                                            <tr>
                                                <td style="width: 40%;">
                                                    <div size="half">
                                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image4', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description4', $currentstoreid); ?>" />
                                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description4', $currentstoreid); ?></div></div>
                                                    </div>      
                                                </td>
                                                <td style="width: 60%;">
                                                    <div size="half">
                                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image5', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description5', $currentstoreid); ?>" />
                                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description5', $currentstoreid); ?></div></div>
                                                    </div>
                                                </td>
                                            </tr>
                                       </table> 
                                    </td>
                                </tr>
                            </table>
                            <div class="designfeaturesheadimage landscapefeature"></div>
                        </td>
                    </tr>
                </table>
            </div>      
        <?php
     }
?>
<?php
     if($_product->getAttributeText('design_feature_view') == "Potrait" && $productmodel->getAttributeRawValue($productid, 'design_feature_image1', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image2', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image3', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image4', $currentstoreid) != "" && $productmodel->getAttributeRawValue($productid, 'design_feature_image5', $currentstoreid) != "")
     {
        ?>
            <div class="fullscreen colorbg pgsection">
                <table class="fullscreentable">
                    <tr>
                        <td style="padding: 0 50px;">
                            <table class="productdesignfeatures">
                                <tr>
                                    <td style="width: 33.33%;">
                                       <div size="half">
                                                <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image1', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description1', $currentstoreid); ?>" />
                                                <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description1', $currentstoreid); ?></div></div>
                                        </div> 
                                    </td>
                                    <td rowspan="2" style="width: 33.33%;">
                                        <div size="full">
                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image2', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description2', $currentstoreid); ?>" />
                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description2', $currentstoreid); ?></div></div>
                                        </div>
                                    </td>
                                    <td rowspan="2" style="width: 33.33%;">
                                        <div size="full">
                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image3', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description3', $currentstoreid); ?>" />
                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description3', $currentstoreid); ?></div></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 33.33%; vertical-align: bottom;">
                                        <table style="width: 100%;">
                                            <tr>
                                                <td style="width: 50%;">
                                                    <div size="half">
                                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image4', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description4', $currentstoreid); ?>" />
                                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description4', $currentstoreid); ?></div></div>
                                                    </div>      
                                                </td>
                                                <td style="width: 50%;">
                                                    <div size="half">
                                                            <img src="<?php echo $this->getSkinUrl('images/catalog/product/designfeatures/'.$productmodel->getAttributeRawValue($productid, 'design_feature_image5', $currentstoreid)); ?>" alt="<?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description5', $currentstoreid); ?>" />
                                                            <div class="caption"><div><?php echo $productmodel->getAttributeRawValue($productid, 'design_feature_description5', $currentstoreid); ?></div></div>
                                                    </div>
                                                </td>
                                            </tr>
                                       </table> 
                                    </td>
                                </tr>
                            </table>
                            <div class="designfeaturesheadimage potraitfeature"></div>
                        </td>
                    </tr>
                </table>
            </div>      
        <?php
     }
?>
*/ ?>
<?php
     if($ftimage != "")
     {
        ?>
            <div id="fabrictechnology" desc="Fabric Technology" style="background-image : url('<?php echo $ftimage; ?>');" class="bgimage pgsection">
            </div>
        <?php
     }
?>
<?php /*
<?php
     if($productmodel->getAttributeRawValue($productid, 'fabric_technology_image', $currentstoreid) != "")
     {
        ?>
            <div id="fabrictechnology" desc="Fabric Technology" style="background-image : url('<?php echo $this->getSkinUrl('images/catalog/product/fabrictechnology/'.$productmodel->getAttributeRawValue($productid, 'fabric_technology_image', $currentstoreid)); ?>');" class="bgimage pgsection">
            </div>        
        <?php
     }
?>
*/ ?>
<div style="display:none;">
    <div id="zoompopup">
        <table class="productzoomtable">
            <tr>
                <td class="zoomproductoptions">
                    <table class="productdetailtable zoomproductdetail">
                        <tr>
                            <td>
                                <div class="productname"><?php echo $productname; ?></div>
                                <div class="productcost"><?php echo $productprice; ?></div>
                                <table class="selectedcolor">
                                    <tr>
                                        <td>COLOR</td>
                                        <td class="selectedcolortext"></td>
                                    </tr>
                                </table>
                                <div id="colorcontainer">
                                    <?php
                                        $first = true;
                                        //print_r($productcolorinfo);
                                         foreach($productcolorinfo as $key=>$colorinfo)
                                        {
                                            ?>
                                                <div>
                                                    <table color="<?php echo $key; ?>" value="<?php echo $colorinfo['value']; ?>">
                                                        <tr>
                                                            <?php
                                                                foreach($colorinfo['hex'] as $hex)
                                                                {
                                                                    ?>
                                                                        <td style="background-color: <?php echo $hex ?>;">
                                                                        <div>
                                                                            &nbsp;
                                                                        </div>                                                
                                                                        </td>   
                                                                    <?php
                                                                } 
                                                            ?>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="<?php echo count($colorinfo['hex']); ?>" <?php if($first) { echo "class='tdselectedcolor'"; $first = false; } ?>>
                                                                  
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>  
                                            <?php
                                        }
                                    ?>
                                </div>
                                <div style="clear: both;"></div>
                                <table class="zoomsmallimagecontainer">
                                    <tr><td><img src="http://192.168.2.110/yogasmoga/media/catalog/product/cache/1/thumbnail/75x75/040ec09b1e35df139433887a97daa66f/a/b/abstract_0073.jpg" /></td></tr>
                                    <tr><td><img src="http://192.168.2.110/yogasmoga/media/catalog/product/cache/1/thumbnail/75x75/040ec09b1e35df139433887a97daa66f/a/b/abstract_0073.jpg" /></td></tr>
                                    <tr><td><img src="http://192.168.2.110/yogasmoga/media/catalog/product/cache/1/thumbnail/75x75/040ec09b1e35df139433887a97daa66f/a/b/abstract_0073.jpg" /></td></tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                </td>
                <td id="zoomedproductimage">
                    
                </td>
            </tr>
        </table>
        <img id="closelightbox" src="<?php echo $this->getSkinUrl('images/catalog/product/close.png'); ?>" />
    </div>
</div>
<?php echo $this->getChildHtml('upsell_products') ?>